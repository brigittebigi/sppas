<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Brigitte Bigi">
  <title>SPPAS Documentation</title>
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; }
code > span.ch { color: #008080; }
code > span.st { color: #008080; }
code > span.co { color: #008000; }
code > span.ot { color: #ff4000; }
code > span.al { color: #ff0000; }
code > span.er { font-weight: bold; }
  </style>
  <link rel="stylesheet" href="etc/styles/sppas.css">
      <link rel="icon" href="./etc/icons/sppas.png" />
  
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-38055333-4']);
        _gaq.push(['_trackPageview']);
      
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
</head>
<body>

    <!----------------------------------------------------------------->

    <div class="header">
        <div class="title">
            <div class="h1title">SPPAS</div>
            <div class="h2title">the automatic annotation and analysis of speech</div>
            <div class="h3title">a software tool by Brigitte Bigi, researcher at</div>
            <div class="h3title">Laboratoire Parole et Langage - Aix-en-Provence - France</div>
        </div>
    </div>

    <!----------------------------------------------------------------->

    <div class="menu">
        <a class="home"     href="index.html">Home</a>
        <a class="install"  href="installation.html">Installation</a>
        <a class="download" href="download.html">Download</a>
        <a class="tutorial" href="tutorial.html">Tutorials</a>
        <a class="documentation" href="documentation.html">Documentation</a>
        <a class="group"    href="https://groups.google.com/forum/?fromgroups#!forum/sppas-users">User's group</a>
    </div>

    <!----------------------------------------------------------------->
<header>
<h1 class="title">SPPAS Documentation</h1>
<h2 class="author">Brigitte Bigi</h2>
<h3 class="date">Version 1.8.0</h3>
</header>
<nav id="TOC">
<ul>
<li><a href="#scripting-with-python-and-sppas">Scripting with Python and SPPAS</a><ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#a-gentle-introduction-to-programming">A gentle introduction to programming</a><ul>
<li><a href="#definitions">Definitions</a></li>
<li><a href="#comments-and-blocks">Comments and blocks</a></li>
<li><a href="#variables-assignment-and-typing">Variables: Assignment and Typing</a></li>
<li><a href="#basic-operators">Basic Operators</a></li>
<li><a href="#conditions">Conditions</a></li>
<li><a href="#loops">Loops</a></li>
</ul></li>
<li><a href="#scripting-with-python">Scripting with Python</a><ul>
<li><a href="#hello-world">Hello World!</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#readingwriting-files">Reading/Writing files</a></li>
<li><a href="#dictionaries">Dictionaries</a></li>
<li><a href="#exercises-to-practice">Exercises to practice</a></li>
</ul></li>
<li><a href="#the-api-of-sppas-to-manage-data">The API of SPPAS to manage data</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#why-developing-a-new-api">Why developing a new API?</a></li>
<li><a href="#the-api-class-diagram">The API class diagram</a></li>
</ul></li>
<li><a href="#creating-scripts-with-the-sppas-api">Creating scripts with the SPPAS API</a><ul>
<li><a href="#preparing-the-data">Preparing the data</a></li>
<li><a href="#readwrite-annotated-files">Read/Write annotated files</a></li>
<li><a href="#manipulating-a-transcription-object">Manipulating a Transcription object</a></li>
<li><a href="#manipulating-a-tier-object">Manipulating a Tier object</a></li>
<li><a href="#main-information-on-annotationlocationlabel-objects">Main information on Annotation/Location/Label objects</a></li>
<li><a href="#exercises">Exercises</a></li>
<li><a href="#search-in-annotations-filters">Search in annotations: Filters</a></li>
<li><a href="#exercises-1">Exercises</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<hr />
<h1 id="scripting-with-python-and-sppas">Scripting with Python and SPPAS</h1>
<h2 id="introduction">Introduction</h2>
<p>SPPAS implements an Application Programming Interface (API), named <em>annotationdata</em>, to deal with annotated files.</p>
<p><em>annotationdata</em> API is a free and open source Python library to access and search data from annotated data. It can convert file formats like Elan’s EAF, Praat's TextGrid and others into a <code>Transcription</code> object and convert this object into anyone of these formats. This object allows unified access to linguistic data from a wide range sources.</p>
<p>In this chapter, we are going to create Python scripts with the SPPAS Application Programming Interface <em>annotationdata</em> and then run them. This chapter includes examples and some exercises to practice. Solutions of the exercises are included in the package sub-directory <em>documentation</em>, then <em>solutions</em>.</p>
<p><em>annotationdata</em> is based on the Programming Language Python, version 2.7. This chapter firstly introduces basic programming concepts, then it will gradually introduce how to write scripts with Python. Those who are familiar with programming in Python can directly go to the last section related to the description of the <em>annotationdata</em> API and how to use it in Python scripts.</p>
<p>In this chapter, it is assumed that Python 2.7 is already installed and configured. It is also assumed that the Python IDLE is ready-to-use. For more details about Python, see:</p>
<blockquote>
<p>The Python Website: <a href="http://www.python.org">http://www.python.org</a></p>
</blockquote>
<h2 id="a-gentle-introduction-to-programming">A gentle introduction to programming</h2>
<p>This section is partially made of selected parts of <em>the Python website</em> and <em>wikipedia</em>.</p>
<h3 id="definitions">Definitions</h3>
<p><em>Programming</em> is the process of writing instructions for computers to produce software for users. More than anything, it is a creative and problem-solving activity. Any problem can be solved in a large number of ways.</p>
<p>An <em>algorithm</em> is the step-by-step solution to a certain problem: algorithms are lists of <em>instructions</em> which are followed step by step, from top to bottom and from left to right. To practice writing programs in a programming language, it is required first to think of a the problem and consider the logical solution before writing it out.</p>
<p>Writing a program is done so using a programming language. Thankfully even though some languages are vastly different than others, most share a lot of common ground, so that once anyone knows his/her first language, other languages are much easier to pick up.</p>
<p>Any program is made of statements. A <em>statement</em> is more casually (and commonly) known as a line of code is the smallest standalone element which expresses some action to be carried out while executing the program. It can be one of: comment, assignment, conditions, iterations, etc. Most languages have a fixed set of statements defined by the language.s</p>
<p>Lines of code are grouped in <em>blocks</em>. Blocks are delimited by brackets, braces or by the indentation (depending on the programming language).</p>
<p>The prompt indicates the system is ready to receive input. Most of times, it is represented by '&gt;'. In the following, the prompt is not mentioned.</p>
<h3 id="comments-and-blocks">Comments and blocks</h3>
<p>Comments are not required by the program to work. But comments are necessary! It is commonly admitted that about 25% to 30% of lines of a program must be comments.</p>
<pre class="sourceCode python"><code class="sourceCode python"> <span class="co"># this is a comment in python, bash and others.</span>
 <span class="co"># I can write what I want after the # symbol :-)~</span></code></pre>
<h3 id="variables-assignment-and-typing">Variables: Assignment and Typing</h3>
<p>A <em>variable</em> in any programming language is a named piece of computer memory, containing some information inside. When declaring a variable, it is usually also stated what kind of data it should carry. Assignment is setting a variable to a value. Dynamically typed languages, such as Python, allow automatic conversions between types according to defined rules.</p>
<p>Python variables do not have to be explicitly declared: the declaration happens automatically when a value is assigned to a variable. In most languages, the equal sign (=) is used to assign values to variables.</p>
<pre class="sourceCode python"><code class="sourceCode python"> a = <span class="dv">1</span>
 b = <span class="fl">1.0</span>
 c = <span class="st">&#39;c&#39;</span>
 hello = <span class="st">&#39;Hello world!&#39;</span>
 vrai = <span class="ot">True</span></code></pre>
<p>In the previous example, <code>a</code>, <code>b</code>, <code>c</code>, <code>hello</code> and <code>vrai</code> are variables, <code>a = 1</code> is a declaration with a typed-statement.</p>
<p>Here is a list of some fundamental data types, and their characteristics:</p>
<ul>
<li><em>char</em> Character and/or small integer, 1 byte (signed: -128 to 127 or unsigned: 0 to 255)</li>
<li><em>int</em> Integer, 4 bytes (signed: -2147483648 to 2147483647 or unsigned:0 to 4294967295)</li>
<li><em>bool</em> Boolean value, can take two values <code>True</code> or <code>False</code></li>
<li><em>float</em> Floating point number, 4 bytes</li>
</ul>
<p>Notice that the number <code>0</code> represents the boolean value <code>False</code>.</p>
<p>Assignments are performed with <em>operators</em>. Python Assignment Operators are:</p>
<pre><code> a = 10   # simple assignment operator
 a += 10  # add and assignment operator
 a -= 10
 a *= 10
 a /= 10</code></pre>
<p>Notice that a Character is a single letter, number, punctuation or other value; and a String is a collection of these character values, often manipulated as if it were a single value.</p>
<p>Complex data types are often used, for example: arrays, lists, tree, hash-tables, etc. For example, with Python:</p>
<pre class="sourceCode python"><code class="sourceCode python"> lst = [<span class="st">&#39;a&#39;</span>, <span class="st">&#39;bb&#39;</span>, <span class="st">&#39;ccc&#39;</span>, <span class="st">&#39;dddd&#39;</span>, <span class="st">&#39;eeeee&#39;</span>]
 sublst = lst[<span class="dv">1</span>:<span class="dv">2</span>]</code></pre>
<h3 id="basic-operators">Basic Operators</h3>
<p>Python Arithmetic Operators:</p>
<pre class="sourceCode python"><code class="sourceCode python"> a = <span class="dv">10</span>
 b = <span class="dv">20</span>
 a + b  <span class="co"># Addition</span>
 a - b  <span class="co"># Subtraction</span>
 a * b  <span class="co"># Multiplication</span>
 a / b  <span class="co"># Division</span>
 <span class="dt">float</span>(a) / <span class="dt">float</span>(b)  <span class="co"># try it! and compare with the previous one</span></code></pre>
<h3 id="conditions">Conditions</h3>
<p>Decision making structures require that the programmer specify one or more conditions to be evaluated or tested by the program. The condition statement is a simple control that tests whether a statement is true or false. The condition can include a variable, or be a variable. If the condition is true, then an action occurs. If the condition is false, nothing is done.</p>
<p>Conditions are performed with the help of comparison operators, as equal, less than, greater than, etc.</p>
<p>In the following, we give example of conditions/comparisons in Python.</p>
<pre class="sourceCode python"><code class="sourceCode python"> var = <span class="dv">100</span>
 <span class="kw">if</span> var == <span class="dv">100</span>: 
     <span class="dt">print</span>(<span class="st">&quot;Value of expression is 100&quot;</span>)</code></pre>
<p>Python programming language assumes any non-zero and non-null values as <code>True</code>, and if it is either zero or null, then it is assumed as <code>False</code> value.</p>
<pre class="sourceCode python"><code class="sourceCode python"> <span class="kw">if</span> a == b:
     <span class="dt">print</span>(<span class="st">&#39;equals&#39;</span>)
 <span class="kw">elif</span> a &gt; b:
    <span class="dt">print</span>(<span class="st">&#39;a greater than b&#39;</span>)
 <span class="kw">else</span>:
    <span class="dt">print</span>(<span class="st">&#39;b greater than a&#39;</span>)</code></pre>
<p>Python Comparison Operators:</p>
<pre class="sourceCode python"><code class="sourceCode python"> a == b  <span class="co"># check if equals</span>
 a != b  <span class="co"># check if different</span>
 a &gt; b   <span class="co"># check if a is greater than b</span>
 a &gt;= b  <span class="co"># check if a is greater or equal to b</span>
 a &lt; b
 a &lt;= b</code></pre>
<p>Other Python Operators:</p>
<ul>
<li><code>and</code> Called Logical AND operator. If both the operands are true then the condition becomes true.</li>
<li><code>or</code> Called Logical OR Operator. If any of the two operands are non zero then the condition becomes true.</li>
<li><code>not</code> Called Logical NOT Operator. Use to reverses the logical state of its operand. If a condition is true then Logical NOT operator will make false.</li>
<li><code>in</code> Evaluates to true if it finds a variable in the specified sequence and false otherwise.</li>
</ul>
<h3 id="loops">Loops</h3>
<p>A &quot;loop&quot; is a process in which a loop is initiated until a condition has been met.</p>
<p>A <code>while</code> loop statement repeatedly executes a target statement as long as a given condition is true.</p>
<p>The <code>for</code> loop has the ability to iterate over the items of any sequence, such as a list or a string. The following Python program prints items of a list on the screen:</p>
<pre class="sourceCode python"><code class="sourceCode python"> l = [<span class="st">&#39;fruits&#39;</span>, <span class="st">&#39;viande&#39;</span>, <span class="st">&#39;poisson&#39;</span>, <span class="st">&#39;oeufs&#39;</span>]
 <span class="kw">for</span> item in l:
    <span class="dt">print</span>(item)</code></pre>
<h2 id="scripting-with-python">Scripting with Python</h2>
<h3 id="hello-world">Hello World!</h3>
<p>We are going to create a very simple Python script and then run it. First of all, create a new folder (on your Desktop for example); you can name it &quot;pythonscripts&quot; for example.</p>
<p>Execute the python IDLE (available in the Application-Menu of your operating system).</p>
<figure>
<img src="./etc/img/python_idle.png" alt="The Python IDLE logo" /><figcaption>The Python IDLE logo</figcaption>
</figure>
<p>Then, create a new empty file:</p>
<ul>
<li>by clicking on &quot;File&quot; menu, then &quot;New File&quot;,</li>
<li>or with the shortcut &quot;CTRL&quot;+N.</li>
</ul>
<p>Copy the following code in this newly created file.</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="dt">print</span>(<span class="st">&#39;Hello world!&#39;</span>)</code></pre></td></tr></table>
<figure>
<img src="./etc/screenshots/python_idle_00.png" alt="Hello world! in a Python script" /><figcaption>Hello world! in a Python script</figcaption>
</figure>
<p>Then, save the file in the &quot;pythonscripts&quot; folder. By convention, Python source files end with a <em>.py</em> extension, so I suggest the name <code>01_helloworld.py</code>.</p>
<p>Notice that <code>main</code> (in the code above) is a function.<br />A function does something. This particular function prints, or outputs to the screen, the text, or string, between apostrophes or quotation marks. We've decided to call this function main: the name main is just a convention. We could have called it anything.</p>
<p>To execute the program, you can do one of:</p>
<ul>
<li>with the mouse: Click on the Menu &quot;Run&quot;, then &quot;Run module&quot;</li>
<li>with the keyboard: Press F5</li>
</ul>
<p>The expected output is as follow:</p>
<figure>
<img src="./etc/screenshots/python_idle_01.png" alt="Output of the first script" /><figcaption>Output of the first script</figcaption>
</figure>
<p>A better practice while writing scripts is to describe by who, what and why this script was done. I suggest to create a skeleton for your future scripts, it is useful each time a new script will have to be written.</p>
<p>Here is an example:</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># ----------------------------------------------------------------------------</span>
<span class="co"># Author: Me</span>
<span class="co"># Date:   Today</span>
<span class="co"># Brief:  Simple script to do nothing.</span>
<span class="co"># ----------------------------------------------------------------------------</span>

<span class="ch">import</span> os
<span class="ch">import</span> sys

<span class="co"># ----------------------------------------------------------------------------</span>

<span class="kw">def</span> main():
    <span class="co">&quot;&quot;&quot; This is the main function to do something. &quot;&quot;&quot;</span>
    <span class="kw">pass</span>

<span class="co"># ----------------------------------------------------------------------------</span>
<span class="co"># This is the python entry point:</span>
<span class="co"># Here, we just ask to execute the main function.</span>
<span class="kw">if</span> <span class="ot">__name__</span> == <span class="st">&#39;__main__&#39;</span>:
    main()
<span class="co"># ----------------------------------------------------------------------------</span></code></pre></td></tr></table>
<p>This ready-to-use script is available in the SPPAS package, its name is <code>skeleton.py</code>.</p>
<p>In the example above, the main function is documented: documentation is the text between &quot;&quot;&quot;. In this chapter, all these &quot;docstrings&quot; follow a convention, named &quot;The Epytext Markup Language&quot;. Epytext is a simple lightweight markup language that lets you add formatting and structure to docstrings. The software Epydoc uses that formatting and structure to produce nicely formatted API documentation. For details, see:</p>
<blockquote>
<p>Epydoc web site: <a href="http://epydoc.sourceforge.net/manual-epytext.html">http://epydoc.sourceforge.net/manual-epytext.html</a></p>
</blockquote>
<h3 id="functions">Functions</h3>
<h4 id="simple-function">Simple function</h4>
<p>Now, we'll play with functions! So, create a copy of the file <code>skeleton.py</code>, and add the following function <code>print_vowels()</code>. This function declare a list named <code>vowels</code>. Each item of the list is a string representing a vowel in French encoded in SAMPA (at the phonetic level). Of course, such list can be overridden with any other set of phonemes. Then, the function print each item of the list, by means of a loop.</p>
<table class="sourceCode python numberLines" startFrom="21"><tr class="sourceCode"><td class="lineNumbers"><pre>21
22
23
24
25
26
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> print_vowels():
    <span class="co">&quot;&quot;&quot; Print the list of French vowels on the screen. &quot;&quot;&quot;</span>
    
    vowels = [<span class="st">&#39;a&#39;</span>, <span class="st">&#39;e&#39;</span>, <span class="st">&#39;E&#39;</span>, <span class="st">&#39;i&#39;</span>, <span class="st">&#39;o&#39;</span>, <span class="st">&#39;u&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;@&#39;</span>, <span class="st">&#39;2&#39;</span>, <span class="st">&#39;9&#39;</span>, <span class="st">&#39;a~&#39;</span>, <span class="st">&#39;o~&#39;</span>, <span class="st">&#39;U~&#39;</span>]
    <span class="kw">for</span> v in vowels:
        <span class="dt">print</span>(v)</code></pre></td></tr></table>
<p>The <code>main()</code> function must be changed: instead of printing 'Hello World!', it will call the newly created function <code>print_vowels()</code>.</p>
<table class="sourceCode python numberLines" startFrom="31"><tr class="sourceCode"><td class="lineNumbers"><pre>31
32
33
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> main():
    <span class="co">&quot;&quot;&quot; This is the main function. &quot;&quot;&quot;</span>
    print_vowels()</code></pre></td></tr></table>
<p>Then, save the file in the &quot;pythonscripts&quot; folder and execute the program.</p>
<blockquote>
<p><em>Practice</em>: Add a function to print plosives and call it in the main function (solution: 02_functions.py).</p>
</blockquote>
<figure>
<img src="./etc/screenshots/python_idle_02.png" alt="Output of the second script" /><figcaption>Output of the second script</figcaption>
</figure>
<p>One can also create a function to print glides, another one to print affricates, and so on. Hum... this sounds a little bit fastidious! Lets update, or refactor, our printing function to <em>make it more generic</em>.</p>
<h4 id="function-with-parameters">Function with parameters</h4>
<p>There are times when we need to do something different with only slight variation each time. Rather than writing the same code with only minor differences over and over, we group the code together and use a mechanism to allow slight variations each time we use it. A function is a smaller program with a specific job. In most languages they can be &quot;passed&quot; data, called parameters, which allow us to change the values they deal with.</p>
<p>Notice that the number of parameters of a function is not limited!</p>
<p>In the example, we can replace the <code>print_vowels()</code> function and the <code>print_plosives()</code> function by a single function <code>print_list(mylist)</code> where <code>mylist</code> can be any list containing strings or characters. If the list contains other typed-variables (as int or float), they must be converted to string to be printed out.</p>
<table class="sourceCode python numberLines" startFrom="21"><tr class="sourceCode"><td class="lineNumbers"><pre>21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> print_list(mylist, message=<span class="st">&quot;&quot;</span>):
    <span class="co">&quot;&quot;&quot; Print a list on the screen.</span>

<span class="co">    @param mylist (list) is the list to print</span>
<span class="co">    @param message (string) is an optional message to print before each element </span>

<span class="co">    &quot;&quot;&quot;</span>
    <span class="kw">for</span> element in mylist:
        <span class="dt">print</span>(<span class="st">&quot;</span><span class="ot">{0}</span><span class="st"> </span><span class="ot">{1}</span><span class="st">&quot;</span>.<span class="dt">format</span>(message, element))

<span class="co"># ----------------------------------------------------------------------------</span></code></pre></td></tr></table>
<h4 id="function-return-values">Function return values</h4>
<p>Languages usually have a way to return information from a function, and this is called the return data. This is done with the <code>return</code> key-word. The function stops at this stage, even if some code is following in the block.</p>
<p>In the following example, the function would return a boolean value (True if the given string has no character).</p>
<table class="sourceCode python numberLines" startFrom="21"><tr class="sourceCode"><td class="lineNumbers"><pre>21
22
23
24
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> is_empty(mystr):
    <span class="co">&quot;&quot;&quot; Return True if mystr is empty. &quot;&quot;&quot;</span>
    
    <span class="kw">return</span> <span class="dt">len</span>(mystr.strip()) == <span class="dv">0</span></code></pre></td></tr></table>
<blockquote>
<p>Practice: Add this funtion in a new script and try to print various lists (solution: 03_functions.py)</p>
</blockquote>
<figure>
<img src="./etc/screenshots/python_idle_03.png" alt="Expected output of the 3rd script" /><figcaption>Expected output of the 3rd script</figcaption>
</figure>
<h3 id="readingwriting-files">Reading/Writing files</h3>
<h4 id="reading-data-from-a-file">Reading data from a file</h4>
<p>Now, we'll try to get data from a file. Create a new empty file with the following lines (and add as many lines as you want), then, save it with the name &quot;phonemes.csv&quot; (by using UTF-8 encoding):</p>
<pre><code>occlusives ; b ; b 
occlusives ; d ; d 
fricatives ; f ; f 
liquids ; l ; l 
nasals ; m ; m 
nasals ; n ; n 
occlusives ; p ; p 
glides ; w ; w 
vowels ; a ; a 
vowels ; e ; e </code></pre>
<p>The following statements are typical statements used to read the content of a file. The first parameter of the function <code>open</code> is the file name, including the path (relative or absolute); and the second argument is the opening mode ('r' is the default value, used for reading).</p>
<table class="sourceCode python numberLines" startFrom="21"><tr class="sourceCode"><td class="lineNumbers"><pre>21
22
23
24
25
26
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> main():
    fp = <span class="dt">open</span>(<span class="st">&quot;C:\Users\Me\Desktop\pythonscripts\phonemes.csv&quot;</span>, <span class="st">&#39;r&#39;</span>)
    <span class="kw">for</span> l in fp:
        <span class="co"># do something with the line stored in variable l</span>
        <span class="dt">print</span>(l)
    f.close()</code></pre></td></tr></table>
<p>See the file 04_reading_simple.py for the whole program and try-it (do not forget to change the file name to your own file!).</p>
<p>Like any program... it exists more than one way to solve the problem. The following is a more generic solution, with the ability to deal with various file encodings, thanks to the <code>codecs</code> library:</p>
<table class="sourceCode python numberLines" startFrom="21"><tr class="sourceCode"><td class="lineNumbers"><pre>21
22
23
24
25
26
27
28
29
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> read_file(filename):
    <span class="co">&quot;&quot;&quot; Read the whole file, return lines into a list.</span>

<span class="co">    @param filename (string) Name of the file to read, including path.</span>
<span class="co">    @return List of lines</span>

<span class="co">    &quot;&quot;&quot;</span>
    <span class="kw">with</span> codecs.<span class="dt">open</span>(filename, <span class="st">&#39;r&#39;</span>, encoding=<span class="st">&quot;utf8&quot;</span>) <span class="ch">as</span> fp:
        <span class="kw">return</span> fp.readlines()</code></pre></td></tr></table>
<p>In the previous code, the <code>codecs.open</code> functions got 3 arguments: the file name, the mode (in that case, 'r' means 'read'), and the encoding. The <code>readlines()</code> function get each line of the file <code>f</code> and store it into a list.</p>
<p>The main function can be as follow:</p>
<table class="sourceCode python numberLines" startFrom="35"><tr class="sourceCode"><td class="lineNumbers"><pre>35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> main():
    <span class="co">&quot;&quot;&quot; This is the main function. &quot;&quot;&quot;</span>

    lines = read_file(<span class="st">&quot;C:\Users\Me\Desktop\pythonscripts\phonemes.csv&quot;</span>)

    <span class="co"># before doing something, check the data!</span>
    <span class="kw">if</span> not <span class="dt">len</span>(lines):
        <span class="dt">print</span>(<span class="st">&#39;Hum... the file is empty!&#39;</span>)
        sys.exit(<span class="dv">1</span>)

    <span class="co"># do something with the lines</span>
    <span class="kw">for</span> l in lines:
        <span class="dt">print</span>(l.strip())</code></pre></td></tr></table>
<p>See the file 05_reading_file.py for the whole program, and try-it (do not forget to change the file name to your own file!).</p>
<p>Notice that Python <code>os</code> module provides methods that can help you to perform file-processing operations, such as renaming and deleting files. See Python documentation for details: <a href="https://docs.python.org/2/">https://docs.python.org/2/</a></p>
<h4 id="writing-files">Writing files</h4>
<p>Writing a file requires to open it in a writing mode:</p>
<ul>
<li>'w' is the mode used to write; it will erase any existing file;</li>
<li>'a' is the mode used to append data in an existing file.</li>
</ul>
<p>A file can be opened in an encoding and saved in another one. This could be useful to write a script to convert the encoding of a set of files in a given folder to UTF-8 for example. The following could help to create such a script:</p>
<table class="sourceCode python numberLines" startFrom="10"><tr class="sourceCode"><td class="lineNumbers"><pre>10
11
12
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># getting all files of a given folder:</span>
path = <span class="st">&#39;C:\Users\Me\data&#39;</span>
dirs = os.listdir( path )</code></pre></td></tr></table>
<table class="sourceCode python numberLines" startFrom="15"><tr class="sourceCode"><td class="lineNumbers"><pre>15
16
17
18
19
20
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># Converting encoding of a file:</span>
file_stream = codecs.<span class="dt">open</span>(file_location, <span class="st">&#39;r&#39;</span>, file_encoding)
file_output = codecs.<span class="dt">open</span>(file_location+<span class="st">&#39;utf8&#39;</span>, <span class="st">&#39;w&#39;</span>, <span class="st">&#39;utf-8&#39;</span>)

<span class="kw">for</span> l in file_stream:
    file_output.write(l)</code></pre></td></tr></table>
<h3 id="dictionaries">Dictionaries</h3>
<p>A dictionary is another container type that can store any number of Python objects, including other container types. Dictionaries consist of pairs (called items) of keys and their corresponding values. Each key is separated from its value by a colon (:), the items are separated by commas, and the whole thing is enclosed in curly braces. An empty dictionary without any items is written with just two curly braces, like this: {}. To access dictionary elements, you can use the familiar square brackets along with the key to obtain its value.</p>
<p>The next example is a portion of a program that can be used to convert a list of phonemes from SAMPA to IPA.</p>
<p>To get values from a dictionary, one way is to use directly <code>dict[key]</code>, but it is required to test if key is really in dict, otherwise, Python will stop the program and send an error. Alternatively, the <code>get</code> function can be used, as <code>dict.get(key, default=None)</code> where default is the value to return if the key is missing. In the previous example, it is possible to replace <code>sampadict[phone]</code> by <code>sampadict.get(phone, phone)</code>. Two other functions are useful while using dictionaries:</p>
<ul>
<li>dict.keys() return a list with the keys</li>
<li>dict.values() return a list with values</li>
</ul>
<h3 id="exercises-to-practice">Exercises to practice</h3>
<blockquote>
<p>Exercise 1: How many vowels are in a list of phonemes? (solution: 06_list.py)</p>
</blockquote>
<blockquote>
<p>Exercise 2: Write a SAMPA to IPA converter. (solution: 07_dict.py)</p>
</blockquote>
<blockquote>
<p>Exercise 3: Compare 2 sets of data using NLP techniques (Zipf law, Tf.Idf) (solution: 08_counter.py)</p>
</blockquote>
<h2 id="the-api-of-sppas-to-manage-data">The API of SPPAS to manage data</h2>
<h3 id="overview">Overview</h3>
<p>We are now going to write Python scripts with the help of the <em>annotationdata</em> API included in SPPAS. This API is useful to read/write and manipulate files annotated from various annotation tools as Praat or Elan for example.</p>
<p>First of all, it is important to understand the data structure included in the API to be able to use it efficiently. Details can be found in the following publication:</p>
<blockquote>
<p><em>Brigitte Bigi, Tatsuya Watanabe, Laurent Prévot</em> (2014). <strong>Representing Multimodal Linguistics Annotated data</strong>, Proceedings of the 9th edition of the Language Resources and Evaluation Conference, 26-31 May 2014, Reykjavik, Iceland.</p>
</blockquote>
<h3 id="why-developing-a-new-api">Why developing a new API?</h3>
<p>In the Linguistics field, multimodal annotations contain information ranging from general linguistic to domain specific information. Some are annotated with automatic tools, and some are manually annotated. Linguistics annotation, especially when dealing with multiple domains, makes use of different tools within a given project. Many tools and frameworks are available for handling rich media data. The heterogeneity of such annotations has been recognized as a key problem limiting the interoperability and re-usability of NLP tools and linguistic data collections.</p>
<p>In annotation tools, annotated data are mainly represented in the form of &quot;tiers&quot; or &quot;tracks&quot; of annotations. The genericity and flexibility of &quot;tiers&quot; is appropriate to represent any multimodal annotated data because it simply maps the annotations on the timeline. In most tools, tiers are series of intervals defined by:</p>
<ul>
<li>a time point to represent the beginning of the interval;</li>
<li>a time point to represent the end of the interval;</li>
<li>a label to represent the annotation itself.</li>
</ul>
<p>In Praat, tiers can be represented by a time point and a label (such tiers are named PointTiers and IntervalTiers). Of course, depending on the annotation tool, the internal data representation and the file formats are different. For example, in Elan, unlabelled intervals are not represented nor saved. On the contrary, in Praat, tiers are made of a succession of consecutive intervals (labelled or un-labelled).</p>
<p>The <em>annotationdata</em> API used for data representation is based on the common set of information all tool are currently sharing. This allows to manipulate all data in the same way, regardless of the file type.</p>
<p>The API supports to merge data and annotation from a wide range of heterogeneous data sources for further analysis.</p>
<h3 id="the-api-class-diagram">The API class diagram</h3>
<p>After opening/loading a file, its content is stored in a <code>Transcription</code> object. A <code>Transcription</code> has a name, and a list of <code>Tier</code> objects. This list can be empty. Notice that in a <code>Transcription</code>, two tiers can't have the same name.</p>
<p>A <code>Tier</code> has a name, and a list of <code>Annotation</code> objects. It also contains a set of meta-data and it can be associated to a controlled vocabulary.</p>
<p>A common solution to represent annotation schemes is to put them in a tree. One advantage in representing annotation schemes through those trees, is that the linguists instantly understand how such a tree works and can give a representation of “their” annotation schema. However, each annotation tool is using its own formalism and it is unrealistic to be able to create a generic scheme allowing to map all of them. SPPAS implements another solution that is compatible with trees and/or flat structures (as in Praat). Actually, subdivision relations can be established between tiers. For example, a tier with phonemes is a subdivision reference for syllables, or for tokens, and tokens are a subdivision reference for the orthographic transcription in IPUs. Such subdivisions can be of two categories: alignment or constituency. This data representation allows to keep the Tier representation, which is shared by most of the annotation tools and it allows too to map data on a tree if required: the user can freely create tiers with any names and arrange them in such custom and very easy hierarchy system.</p>
<p>An annotation is made of 2 objects:</p>
<ul>
<li>a <code>Location</code> object,</li>
<li>a <code>Label</code> object.</li>
</ul>
<p>A <code>Label</code> object is representing the &quot;content&quot; of the annotation. It is a list of <code>Text</code> associated to a score.</p>
<p>A <code>Location</code> is representing where this annotation occurs in the media. Then, a <code>Location</code> is made of a list of <code>Localization</code> which includes the <code>BasePlacement</code> associated with a score. A <code>BasePlacement</code> object is one of: * a <code>TimePoint</code> object; or * a <code>TimeInterval</code> object, which is made of 2 <code>TimePoint</code> objects; or * a <code>TimeDisjoint</code> object which is a list of <code>TimeInterval</code>; or * a <code>FramePoint</code> object; or * a <code>FrameInterval</code> object; or * a <code>FrameDisjoint</code> object.</p>
<figure>
<img src="./etc/figures/annotationdata.png" alt="API class diagram" /><figcaption>API class diagram</figcaption>
</figure>
<blockquote>
<p><strong>The whole API documentation is available at the following URL:</strong> <a href="http://www.sppas.org/manual/module-tree.html">http://www.sppas.org/manual/module-tree.html</a></p>
</blockquote>
<h4 id="label-representation">Label representation</h4>
<p>Each annotation holds at least one label, mainly represented in the form of a string, freely written by the annotator or selected from a list of categories, depending on the annotation tool. The <em>&quot;annotationdata&quot;</em> API, aiming at representing any kind of linguistic annotations, allows to assign a score to each label, and allows multiple labels for one annotation. The API also allows to define a controlled vocabulary.</p>
<h4 id="location-representation">Location representation</h4>
<p>In the <em>annotationdata</em> API, a <code>TimePoint</code> is considered <em>as an imprecise value</em>. It is possible to characterize a point in a space immediately allowing its vagueness by using:</p>
<ul>
<li>a midpoint value (center) of the point;</li>
<li>a radius value.</li>
</ul>
<figure>
<img src="./etc/figures/timepoint-represent.png" alt="Representation of a TimePoint" /><figcaption>Representation of a TimePoint</figcaption>
</figure>
<h4 id="example">Example</h4>
<p>The screenshot below shows an example of multimodal annotated data, imported from 3 different annotation tools. Each <code>TimePoint</code> is represented by a vertical dark-blue line with a gradient color to refer to the radius value (0ms for prosody, 5ms for phonetics, discourse and syntax and 40ms for gestures in this screenshot).</p>
<figure>
<img src="./etc/screenshots/Grenelle.png" alt="Example of multimodal data" /><figcaption>Example of multimodal data</figcaption>
</figure>
<h2 id="creating-scripts-with-the-sppas-api">Creating scripts with the SPPAS API</h2>
<h3 id="preparing-the-data">Preparing the data</h3>
<p>If it is not already done, create a new folder (on your Desktop for example); you can name it &quot;pythonscripts&quot; for example.</p>
<p>Open a File Explorer window and go to the SPPAS folder location. Then, open the <code>sppas</code> directory then <code>src</code> sub-directory. Copy the <code>annotationdata</code> folder then paste-it into the newly created <code>pythonscripts</code> folder.</p>
<p>Open the python IDLE and create a new empty file. Copy the following code in this newly created file, then save the file in the pythonscripts folder. By convention, Python source files end with a .py extension; I suggest skeleton-sppas.py. It will allow to use the SPPAS API in your script.</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># ----------------------------------------------------------------------------</span>
<span class="co"># Author: Me</span>
<span class="co"># Date:   Today</span>
<span class="co"># Brief:  Script using the SPPAS API</span>
<span class="co"># ----------------------------------------------------------------------------</span>

<span class="ch">import</span> os
<span class="ch">import</span> sys

<span class="co"># Get SPPAS API</span>
<span class="ch">import</span> sppas.src.annotationdata.aio <span class="ch">as</span> aio
<span class="ch">from</span> sppas.src.annotationdata <span class="ch">import</span> Transcription
<span class="ch">from</span> sppas.src.annotationdata <span class="ch">import</span> Tier
<span class="ch">from</span> sppas.src.annotationdata <span class="ch">import</span> Annotation
<span class="ch">from</span> sppas.src.annotationdata <span class="ch">import</span> Label
<span class="ch">from</span> sppas.src.annotationdata <span class="ch">import</span> TimePoint
<span class="ch">from</span> sppas.src.annotationdata <span class="ch">import</span> TimeInterval
<span class="ch">from</span> sppas.src.annotationdata <span class="ch">import</span> Bool, Rel

<span class="co"># ----------------------------------------------------------------------------</span>

<span class="kw">def</span> main():
    <span class="co">&quot;&quot;&quot; This is the main function. &quot;&quot;&quot;</span>
    <span class="kw">pass</span>

<span class="co"># ----------------------------------------------------------------------------</span>
<span class="co"># This is the python entry point:</span>
<span class="co"># Here, we just ask to execute the main function.</span>
<span class="kw">if</span> <span class="ot">__name__</span> == <span class="st">&#39;__main__&#39;</span>:
    main()
<span class="co"># ----------------------------------------------------------------------------</span></code></pre></td></tr></table>
<p>Navigate to the folder containing your script, and open-it with the python IDLE. To execute the file:</p>
<ul>
<li>Menu: &quot;Run&quot;, then &quot;Run module&quot;</li>
<li>Keyboard: F5</li>
</ul>
<p>It will do... nothing! But now, we are ready to do something with the API!</p>
<h3 id="readwrite-annotated-files">Read/Write annotated files</h3>
<p>Open/Read a file of any format (TextGrid, Elan, Transcriber, ...) and store it into a <code>Transcription</code> object instance, named <code>trs</code> in the following code, is mainly done as:</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode python">trs = aio.read(filename_in)</code></pre></td></tr></table>
<p>Save/Write a <code>Transcription</code> object instance in a file of any format is mainly done as:</p>
<table class="sourceCode python numberLines" startFrom="2"><tr class="sourceCode"><td class="lineNumbers"><pre>2
</pre></td><td class="sourceCode"><pre><code class="sourceCode python">aio.write(filename_out, trs)</code></pre></td></tr></table>
<p>These two lines of code loads any annotation file (Elan, Praat, Transcriber...) and writes the data into another file. The format of the file is given by its extension, as for example &quot;.xra&quot; is the SPPAS native format, &quot;.TextGrid&quot; is one of the Praat native format, and so on.</p>
<p>So... only both lines are used to convert a file from one format to another one!</p>
<p>In any script, to get the list of accepted extensions as input, just call &quot;annotationdata.io.extensions_in&quot;, and the list of accepted extensions as output is &quot;annotationdata.io.extensions_out&quot;.</p>
<p>Currently, accepted input file extensions are:</p>
<ul>
<li>xra</li>
<li>csv, txt</li>
<li>TextGrid, PitchTier, IntensityTier</li>
<li>eaf</li>
<li>trs</li>
<li>mrk</li>
<li>sub, srt</li>
<li>hz</li>
<li>antx</li>
<li>tdf</li>
</ul>
<p>Possible output file extensions are:</p>
<ul>
<li>xra</li>
<li>csv, txt, lab, ctm, stm</li>
<li>TextGrid, PitchTier</li>
<li>eaf</li>
<li>mrk</li>
<li>sub, srt</li>
<li>antx</li>
</ul>
<blockquote>
<p>Practice: Write a script to convert a TextGrid file into CSV (solution: 10_read_write.py)</p>
</blockquote>
<h3 id="manipulating-a-transcription-object">Manipulating a Transcription object</h3>
<p>The most useful functions used to manage a Transcription object are:</p>
<ul>
<li><code>Append(tier)</code>, <code>Pop()</code></li>
<li><code>Add(tier, index)</code>, <code>Remove(index)</code></li>
<li><code>Find(name, case_sensitive=True)</code></li>
</ul>
<p><code>Append()</code> is used to add a tier at the end of the list of tiers of the Transcription object; and <code>Pop()</code> is used to remove the last tier of such list.</p>
<p><code>Add()</code> and <code>Remove()</code> do the same, except that it does not put/delete the tier at the end of the list but at the given index.</p>
<p><code>Find()</code> is useful to get a tier of the list from its name.</p>
<p>There are useful &quot;shortcuts&quot; that can be used. For example, <code>trs[0]</code> returns the first tier, <code>len(trs)</code> returns the number of tiers and loops can be written as:</p>
<table class="sourceCode python numberLines" startFrom="15"><tr class="sourceCode"><td class="lineNumbers"><pre>15
16
17
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">for</span> tier in trs:
    <span class="co"># do something with the tier</span>
    <span class="dt">print</span>(tier.GetName())</code></pre></td></tr></table>
<blockquote>
<p>Practice: Write a script to select a set of tiers of a file and save them into a new file (solution: 11_transcription.py).</p>
</blockquote>
<h3 id="manipulating-a-tier-object">Manipulating a Tier object</h3>
<p>As it was already said, a tier is made of a name and a list of annotations. To get the name of a tier, or to fix a new name, the easier way is to use tier.GetName().</p>
<p>Test the following code into a script:</p>
<table class="sourceCode python numberLines" startFrom="15"><tr class="sourceCode"><td class="lineNumbers"><pre>15
16
17
18
19
20
</pre></td><td class="sourceCode"><pre><code class="sourceCode python">trs = aio.read(filename)
tier = trs[<span class="dv">0</span>]
<span class="dt">print</span>(tier.GetName())
tier.SetName(<span class="st">&quot;toto&quot;</span>)
<span class="dt">print</span>(tier.GetName())
<span class="dt">print</span>(trs[<span class="dv">0</span>].GetName())</code></pre></td></tr></table>
<p>The most useful functions used to manage a Tier object are:</p>
<ul>
<li><code>Append(annotation)</code>, <code>Pop()</code></li>
<li><code>Add(annotation)</code>, <code>Remove(begin, end, overlaps=False)</code></li>
<li><code>IsDisjoint()</code>, <code>IsInterval()</code>, <code>IsPoint()</code></li>
<li><code>Find(begin, end, overlaps=True)</code></li>
<li><code>Near(time, direction)</code></li>
<li><code>SetRadius(radius)</code></li>
</ul>
<blockquote>
<p>Practice: Write a script to open an annotated file and print information about tiers (solution: 12_tiers_info.py)</p>
</blockquote>
<p><strong>Goodies:</strong></p>
<p>the file <code>12_tiers_info_wx.py</code> proposes a GUI to print information of one file or all files of a directory, and to ask the file/directory name with a dialogue frame, instead of fixing it in the script. This script can be executed simply by double-clicking on it in the File Explorer of your system. Many functions of this script can be cut/pasted in any other script.</p>
<h3 id="main-information-on-annotationlocationlabel-objects">Main information on Annotation/Location/Label objects</h3>
<p>The most useful function used to manage an Annotation object are:</p>
<ul>
<li><code>IsSilence()</code>, <code>IsLabel()</code></li>
<li><code>IsPoint()</code>, <code>IsInterval()</code>, <code>IsDisjoint()</code></li>
<li><code>GetBegin()</code>, <code>SetBegin(time)</code>, only if time is a TimeInterval</li>
<li><code>GetEnd()</code>, <code>SetEnd(time)</code>, only if time is a TimeInterval</li>
<li><code>GetPoint()</code>, <code>SetPoint(time)</code>, only if time is a TimePoint</li>
</ul>
<p>The following example shows how to get/set a new label, and to set a new time to an annotation:</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">if</span> ann.GetLabel().IsEmpty():
    ann.GetLabel().SetValue(<span class="st">&quot;dummy&quot;</span>)
<span class="kw">if</span> ann.GetLocation().IsPoint():
    p = ann.GetLocation().GetPoint()
    p.SetMidPoint(<span class="fl">0.234</span>)
    p.SetRadius(<span class="fl">0.02</span>)
<span class="kw">if</span> ann.GetLocation().IsInterval():
    ann.GetLocation().GetBegin().SetMidPoint(<span class="fl">0.123</span>)
    ann.GetLocation().GetEnd().SetMidPoint(<span class="fl">0.234</span>)    </code></pre></td></tr></table>
<p>If something forbidden is attempted, the object will raise an Exception. This means that the program will stop (except if the program &quot;raises&quot; the exception).</p>
<h3 id="exercises">Exercises</h3>
<blockquote>
<p>Exercise 1: Write a script to print information about annotations of a tier (solution: 13_tiers_info.py)</p>
</blockquote>
<blockquote>
<p>Exercise 2: Write a script to estimates the frequency of a specific annotation label in a file/corpus (solution: 14_freq.py)</p>
</blockquote>
<h3 id="search-in-annotations-filters">Search in annotations: Filters</h3>
<h4 id="overview-1">Overview</h4>
<p>This section focuses on the problem of <em>searching and retrieving</em> data from annotated corpora.</p>
<p>The filter implementation can only be used together with the <code>Tier()</code> class. The idea is that each <code>Tier()</code> can contain a set of filters, that each reduce the full list of annotations to a subset.</p>
<p>SPPAS filtering system proposes 2 main axis to filter such data:</p>
<ul>
<li>with a boolean function, based on the content, or on the time,</li>
<li>with a relation function between intervals of 2 tiers.</li>
</ul>
<p>A set of filters can be created and combined to get the expected result, with the help of the boolean function and the relation function.</p>
<p>To be able to apply filters to a tier, some data must be loaded first. First, you have to create a new <code>Transcription()</code> when loading a file. In the next step, you have to select the tier to apply filters on. Then, if the input file was not XRA, it is widely recommended to fix a radius value depending on the annotation type. Now everything is ready to create filters for these data.</p>
<h4 id="creating-a-boolean-function">Creating a boolean function</h4>
<p>In the following, let <code>Bool</code> and <code>Rel</code> two predicates, a tier <code>T</code>, and a filter <code>f</code>.</p>
<p>Pattern selection is an important part to extract data of a corpus. In this case, each filter consists of search terms for each of the tiers that were loaded from an input file. Thus, the following matching predicates are proposed to select annotations (intervals or points) depending on their label. Notice that <code>P</code> represents the text pattern to find:</p>
<ul>
<li>exact match: <code>pr = Bool(exact=P)</code>, means that a label is valid if it strictly corresponds to the expected pattern;</li>
<li>contains: <code>pr = Bool(contains=P)</code>, means that a label is valid if it contains the expected pattern;</li>
<li>starts with, <code>pr = Bool(startswith=P)</code>, means that a label is valid if itstarts with the expected pattern;</li>
<li>ends with, <code>pr = Bool(endswith=P)</code>, means that a label is valid if it ends with the expected pattern.</li>
</ul>
<p>These predicates are then used while creating a filter on labels. All these matches can be reversed, to represent does not exactly match, does not contain, does not start with or does not end with, as for example:</p>
<pre class="sourceCode python"><code class="sourceCode python">tier = trs.Find(<span class="st">&quot;PhonAlign&quot;</span>)
ft = Filter(tier)
f1 = LabelFilter(Bool(exact=<span class="st">&#39;a&#39;</span>), ft)
f2 = LabelFilter(~Bool(iexact=<span class="st">&#39;a&#39;</span>), ft)</code></pre>
<p>In this example, <code>f1</code> is a filter used to get all phonemes with the exact label 'a'. On the other side, <code>f2</code> is a filter that ignores all phonemes matching with 'a' (mentioned by the symbol '~') with a case insensitive comparison (iexact means insensitive-exact).</p>
<p>For complex search, a selection based on regular expressions is available for advanced users, as <code>pr = Bool(regexp=R)</code>.</p>
<p>A multiple pattern selection can be expressed with the operators <code>|</code> to represent the logical &quot;or&quot; and the operator <code>&amp;</code> to represent the logical &quot;and&quot;.</p>
<p>With this notation in hands, it is possible to formulate queries as, for example: <em>Extract words starting by &quot;ch&quot; or &quot;sh&quot;</em>, as:</p>
<pre class="sourceCode python"><code class="sourceCode python">pr = Bool(startswith=<span class="st">&quot;ch&quot;</span>) | Bool(startswith=<span class="st">&quot;sh&quot;</span>)</code></pre>
<p>Filters on duration can also be created on annotations if Time instance is of type TimeInterval. In the following, <code>v</code> represents the value to be compared with:</p>
<ul>
<li>lower: <code>pr = Bool(duration_lt=v)</code>, means that an annotation of <code>T</code> is valid if its duration is lower than <code>v</code>;</li>
<li>lower or equal: <code>pr = Bool(duration_le=v)</code>;</li>
<li>greater: <code>pr = Bool(duration_gt=v)</code>;</li>
<li>greater or equal: <code>pr = Bool(duration_ge=v)</code>;</li>
<li>equal: <code>pr = Bool(duration_e=v)</code>;</li>
</ul>
<p>Search can also starts and ends at specific time values in a tier by creating filters with <code>begin_ge</code> and <code>end_le</code>.</p>
<p>The, the user must apply the filter to get filtered data from the filter.</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># creating a complex boolean function</span>
predicate = (Bool(icontains=<span class="st">&quot;a&quot;</span>) | Bool(icontains=<span class="st">&quot;e&quot;</span>)) &amp; Bool(duration_ge=<span class="fl">0.08</span>)

<span class="co"># to create a filter:</span>
ft = Filter(tier)
flab = LabelFilter(predicate, ft)

<span class="co"># to get filtered data from the filter:</span>
tier = flab.Filter()
tier.SetName(<span class="st">&#39;Filtered with a-e-0.8&#39;</span>)</code></pre></td></tr></table>
<h4 id="creating-a-relation-function">Creating a relation function</h4>
<p>Relations between annotations is crucial if we want to extract multimodal data. The aim here is to select intervals of a tier depending on what is represented in another tier.</p>
<p>We implemented the 13 Allen interval relations: before, after, meets, met by, overlaps, overlapped by, starts, started by, finishes, finished by, contains, during and equals. Actually, we implemented the 25 relations proposed in the INDU model. This model is fixing constraints on INtervals (with Allen's relations) and on DUration (duration are equals, one is less/greater than the other).</p>
<p>[List of Allen interval relations]&lt;./etc/screenshots/allen.png&gt;</p>
<p>Below is an example of request: <em>Which syllables stretch across 2 words?</em></p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># Get tiers from a Transcription object</span>
tiersyll = trs.Find(<span class="st">&quot;Syllables&quot;</span>)
tiertoks = trs.Find(<span class="st">&quot;TokensAlign&quot;</span>)

<span class="co"># Create filters</span>
fsyll = Filter(tiersyll)
ftoks = Filter(tiertoks)

<span class="co"># Create the filter with the relation function (link both filters)</span>
predicate = Rel(<span class="st">&quot;overlaps&quot;</span>) | Rel(<span class="st">&quot;overlappedby&quot;</span>)
f = RelationFilter(relation, fsyll, ftoks)</code></pre></td></tr></table>
<h3 id="exercises-1">Exercises</h3>
<blockquote>
<p>Exercise 1: Create a script to filter annotated data on their label (solution: 15_annotation_label_filter.py).</p>
</blockquote>
<blockquote>
<p>Exercise 2: Idem with a filter on duration or time. (solution: 16_annotation_time_filter.py).</p>
</blockquote>
<blockquote>
<p>Exercise 3: Create a script to get tokens followed by a silence. (solution: 17_annotations_relation_filter1.py).</p>
</blockquote>
<blockquote>
<p>Exercise 4: Create a script to get tokens preceded by OR followed by a silence. (solution: 17_annotations_relation_filter2.py).</p>
</blockquote>
<blockquote>
<p>Exercise 5: Create a script to get tokens preceded by AND followed by a silence. (solution: 17_annotations_relation_filter3.py).</p>
</blockquote>
<hr />
    <!----------------------------------------------------------------->

    <div class="footer">
        <a href="index.html"><img src="./etc/logos/sppas-logo.png" alt="SPPAS"></a>
        <p class="copyright">
            <a href="mailto:brigitte.bigi@gmail.com">Brigitte Bigi</a> &copy; 2011-2016
        </p>
    </div>

    <!----------------------------------------------------------------->

    <span class="scrollT"></span>
    <script type="text/javascript" src="./etc/scripts/jquery.min.js"></script>
    <script type="text/javascript" src="./etc/scripts/scrollT.js"></script>
    <script type="text/javascript">
        // On active la fonction permettant de faire apparaitre l'indicateur 
        // de scroll pour remonter en haut de page.
        $(document).ready(function() 
        {
            $(this).scrollT();
        });
    </script>

    <!----------------------------------------------------------------->
</body>
</html>
