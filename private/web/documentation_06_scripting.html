<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; }
code > span.ch { color: #008080; }
code > span.st { color: #008080; }
code > span.co { color: #008000; }
code > span.ot { color: #ff4000; }
code > span.al { color: #ff0000; }
code > span.er { font-weight: bold; }
  </style>
  <link rel="stylesheet" href="./etc/styles/sppas.css" />
      <title>Documentation</title>
      <link rel="icon" href="./etc/icons/sppas.png" />
  
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-38055333-4']);
        _gaq.push(['_trackPageview']);
      
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
</head>
<body>

    <!----------------------------------------------------------------->

    <div class="header"></div>

    <!----------------------------------------------------------------->

    <nav>
    <label for="menu-mobile" class="menu-mobile">Menu</label>
    <input type="checkbox" id="menu-mobile" role="button">

        <ul>
            <li class="menu-home current nav"><a class="nav" href="index.html">Home</a></li>
            <li class="menu-get nav"><a class="nav">Get it!</a>
                <ul class="submenu">
                    <li class="nav"><a class="nav" href="download.html">Download</a></li>
                    <li class="nav"><a class="nav" href="installation.html">Install</a></li>
                </ul>
            <li class="menu-tuto nav"><a class="nav">Discover</a>
                <ul class="submenu">
                    <li class="nav"><a class="nav" href="features.html">Main features of SPPAS</a></li>
                    <li class="nav"><a class="nav" href="tutorial.html">Tutorials</a></li>
                </ul>
            </li>
            <li class="menu-doc nav"><a class="nav">Documentation</a>
                <ul class="submenu">
                    <li class="nav"><a class="nav" href="documentation_01_introduction.html">Introduction</a></li>
                    <li class="nav"><a class="nav" href="documentation_02_interface.html">Interface</a></li>
                    <li class="nav"><a class="nav" href="documentation_03_annotations.html">Annotations</a></li>
                    <li class="nav"><a class="nav" href="documentation_04_resources.html">Resources</a></li>
                    <li class="nav"><a class="nav" href="documentation_05_analyses.html">Analyses</a></li>
                    <li class="nav"><a class="nav" href="documentation_06_scripting.html">Scripting</a></li>
                    <li class="nav"><a class="nav" href="documentation_07_references.html">Publications</a></li>
                    <li class="nav"><a class="nav" href="documentation_08_changes.html">History</a></li>
                    <li class="nav"><a class="nav" href="documentation_09_annexes.html">Annexes</a></li>
                </ul>
            </li>
            <li class="menu-faq nav"><a class="nav">Help</a>
                <ul class="submenu">
                    <li class="nav"><a class="nav" href="faq.html">Frequently Asked Questions</a></li>
                    <li class="nav"><a class="nav" href="mailto:contact@sppas.org?Subject=[SPPAS] Question..." target="_top">Contact the author</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <!----------------------------------------------------------------->

    <div class="cols1 bg-lightgrey">
        <div class="cols12"></div>
        <div class="cols2">
<h1 id="scripting-with-python-and-sppas">Scripting with Python and SPPAS</h1>
<h2 id="introduction">Introduction</h2>
<p>Since version 1.8.7, SPPAS implements an Application Programming Interface (API), named <em>anndata</em>, to deal with annotated files. Previously, SPPAS was based on another API named <em>annotationdata</em> which is still distributed in the package but no longer updated or maintained.</p>
<p><em>anndata</em> API is a free and open source Python library to access and search data from annotated data of any of the supported formats (xra, TextGrid, eaf...). It can either be used with the Programming Language Python 2.7 or Python 3.4+. This API is PEP8 and PEP257 compliant and the internationalization of the messages is implemented (English and French are available in the &quot;po&quot; directory).</p>
<p>In this chapter, it is assumed that a version of Python is installed and configured. It is also assumed that the Python IDLE is ready-to-use. For more details about Python, see:</p>
<blockquote>
<p>The Python Website: <a href="http://www.python.org">http://www.python.org</a></p>
</blockquote>
<p>This chapter firstly introduces basic programming concepts, then it gradually introduces how to write scripts with Python. Those who are familiar with programming in Python can directly go to the last section related to the description of the <em>anndata</em> API and how to use it in Python scripts.</p>
<p>This API can convert file formats like Elanâ€™s EAF, Praat's TextGrid and others into a <code>sppasTranscription</code> object and convert this object into any of these formats. This object allows unified access to linguistic data from a wide range sources.</p>
<pre><code>This chapter includes exercises. The solution scripts are included in
the package directory *documentation*, folder *scripting_solutions*.</code></pre>
<h2 id="a-gentle-introduction-to-programming">A gentle introduction to programming</h2>
<h3 id="introduction-1">Introduction</h3>
<p>This section includes examples in Python programming language. You may want to try out some of the examples that come with the description. In order to do this, execute the Python IDLE - available in the Application-Menu of your operating system, and write the examples after the prompt &quot;&gt;&gt;&gt;&quot;.</p>
<figure>
<img src="./etc/logos/python_idle.png" alt="The Python IDLE logo" /><figcaption>The Python IDLE logo</figcaption>
</figure>
<p>To get information about the IDLE, get access to <a href="https://docs.python.org/2/library/idle.html">the IDLE documentation</a></p>
<p>Writing any program consists of writing statements so using a programming language. A <em>statement</em> is often known as a line of code that can be one of:</p>
<ul>
<li>comment,</li>
<li>documentation,</li>
<li>assignment,</li>
<li>conditions,</li>
<li>iterations, etc.</li>
</ul>
<p>Lines of code are grouped in <em>blocks</em>. Depending on the programming language, blocks delimited by brackets, braces or by the indentation.</p>
<p>Each language has its own syntax to write these lines and the user has to follow strictly this syntax for the program to be able to interpret the program. However, the amount of freedom the user has to use capital letters, whitespace and so on is very high. Recommendations for Python language are available in the <a href="https://www.python.org/dev/peps/pep-0008/">PEP8 - Style Guide for Python Code</a>.</p>
<h3 id="variables-assignment-and-typing">Variables: Assignment and Typing</h3>
<p>A <em>variable</em> is a name to give to a piece of memory with some information inside. Assignment is then the action of setting a variable to a value. The equal sign (=) is used to assign values to variables.</p>
<pre class="sourceCode python"><code class="sourceCode python"> &gt;&gt;&gt;a = <span class="dv">1</span>    
 &gt;&gt;&gt;b = <span class="fl">1.0</span>
 &gt;&gt;&gt;c = <span class="st">&quot;c&quot;</span>
 &gt;&gt;&gt;hello = <span class="st">&quot;Hello world!&quot;</span>
 &gt;&gt;&gt;vrai = <span class="ot">True</span></code></pre>
<p>In the previous example, <code>a</code>, <code>b</code>, <code>c</code>, <code>hello</code> and <code>vrai</code> are variables, <code>a = 1</code> is a declaration.</p>
<figure>
<img src="./etc/screenshots/python_idle_example.png" alt="Variable declarations and print in the Python IDLE" /><figcaption>Variable declarations and print in the Python IDLE</figcaption>
</figure>
<p>Assignments to variables with Python language can be performed with the following operators:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; a = <span class="dv">10</span>   <span class="co"># simple assignment operator</span>
&gt;&gt;&gt; a += <span class="dv">2</span>   <span class="co"># add and assignment operator, so a is 12</span>
&gt;&gt;&gt; a -= <span class="dv">7</span>   <span class="co"># minus and assignment, so a is 5</span>
&gt;&gt;&gt; a *= <span class="dv">20</span>  <span class="co"># multiply and assignment, so a is 100</span>
&gt;&gt;&gt; a /= <span class="dv">10</span>  <span class="co"># divide and assignment, so a is 10</span>
&gt;&gt;&gt; a        <span class="co"># verify the value of a...</span>
<span class="dv">10</span></code></pre>
<h3 id="basic-operators">Basic Operators</h3>
<p>Basic operators are used to manipulate variables. The following is the list of operators that can be used with Python, i.e. equal (assignment), plus, minus, multiply, divide:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; a = <span class="dv">10</span>
&gt;&gt;&gt; b = <span class="dv">20</span>  <span class="co"># assignment</span>
&gt;&gt;&gt; a + b   <span class="co"># addition</span>
&gt;&gt;&gt; a - b   <span class="co"># subtraction</span>
&gt;&gt;&gt; a * b   <span class="co"># multiplication</span>
&gt;&gt;&gt; a / b   <span class="co"># division</span></code></pre>
<h3 id="data-types">Data types</h3>
<p>The variables are of a data-type. For example, the declarations <code>a=1</code> and <code>a=1.0</code> are respectively assigning an integer and a real number. In Python, the command <code>type</code> allows to get the type of a variable, like in the following:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; <span class="dt">type</span>(a)
&lt;<span class="dt">type</span> <span class="st">&#39;int&#39;</span>&gt;
&gt;&gt;&gt; <span class="dt">type</span>(b)
&lt;<span class="dt">type</span> <span class="st">&#39;float&#39;</span>&gt;
&gt;&gt;&gt; <span class="dt">type</span>(c)
&lt;<span class="dt">type</span> <span class="st">&#39;str&#39;</span>&gt;
&gt;&gt;&gt; <span class="dt">type</span>(cc)
&lt;<span class="dt">type</span> <span class="st">&#39;unicode&#39;</span>&gt;
&gt;&gt;&gt; <span class="dt">type</span>(vrai)
&lt;<span class="dt">type</span> <span class="st">&#39;bool&#39;</span>&gt;</code></pre>
<p>Here is a list of some fundamental data types, and their characteristics:</p>
<ul>
<li><em>str</em> String of characters</li>
<li><em>unicode</em> Unicode string of characters</li>
<li><em>int</em> Integer in range from -2147483648 to 2147483647</li>
<li><em>bool</em> Boolean value, can take value <code>True</code> (=1) or <code>False</code> (=0)</li>
<li><em>float</em> Floating point number (max 15 digits)</li>
</ul>
<p>Python is assigning data types dynamically. As a consequence, the result of the sum between an <code>int</code> and a <code>float</code> is a <code>float</code>. The next examples illustrate that the type of the variables have to be carefully managed.</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; a = <span class="dv">10</span>
&gt;&gt;&gt; a += <span class="dv">0</span>.
&gt;&gt;&gt; a
<span class="fl">10.0</span>
&gt;&gt;&gt; a += <span class="ot">True</span>
&gt;&gt;&gt; a
<span class="fl">11.0</span>
&gt;&gt;&gt; a += <span class="st">&quot;a&quot;</span>
Traceback (most recent call last):
  File <span class="st">&quot;&lt;input&gt;&quot;</span>, line <span class="dv">1</span>, in &lt;module&gt;
<span class="ot">TypeError</span>: unsupported operand <span class="dt">type</span>(s) <span class="kw">for</span> +=: <span class="st">&#39;float&#39;</span> and <span class="st">&#39;str&#39;</span>
&gt;&gt;&gt; a = <span class="st">&quot;a&quot;</span>
&gt;&gt;&gt; a *= <span class="dv">5</span>
&gt;&gt;&gt; a
<span class="co">&#39;aaaaa&#39;</span></code></pre>
<p>The type of a variable can be explicitly changed. This is called a &quot;cast&quot;:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; a = <span class="dv">10</span>
&gt;&gt;&gt; b = <span class="dv">2</span>
&gt;&gt;&gt; a/b
<span class="dv">5</span>
&gt;&gt;&gt; <span class="dt">float</span>(a) / <span class="dt">float</span>(b)
<span class="fl">5.0</span>
&gt;&gt;&gt; a = <span class="dv">1</span>
&gt;&gt;&gt; b = <span class="dv">1</span> 
&gt;&gt;&gt; <span class="dt">str</span>(a) + <span class="dt">str</span>(b)
<span class="co">&#39;11&#39;</span></code></pre>
<p>Complex data types are often used to store variables sharing the same properties like a list of numbers, and so on. Common types in languages are lists/arrays and dictionaries. The following is the assignment of a list with name <code>fruits</code>, then the assignment of a sub-part of the list to the <code>to_buy</code> list:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; fruits = [<span class="st">&#39;apples&#39;</span>, <span class="st">&#39;tomatoes&#39;</span>, <span class="st">&#39;peers&#39;</span>, <span class="st">&#39;bananas&#39;</span>, <span class="st">&#39;lemons&#39;</span>]
&gt;&gt;&gt; to_buy = fruits[<span class="dv">1</span>:<span class="dv">3</span>]
&gt;&gt;&gt; to_buy
[<span class="st">&#39;tomatoes&#39;</span>, <span class="st">&#39;peers&#39;</span>]</code></pre>
<h3 id="conditions">Conditions</h3>
<p>Conditions aim to test whether a statement is True or False. The statement of the condition can include a variable, or be a variable and is written with operators. The following shows examples of conditions/comparisons in Python. Notice that the comparison of variables of a different data-type is possible (but not recommended!).</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; var = <span class="dv">100</span>
&gt;&gt;&gt; <span class="kw">if</span> var == <span class="dv">100</span>: 
...     <span class="dt">print</span>(<span class="st">&quot;Value of expression is 100.&quot;</span>)
...
Value of expression is <span class="dv">100</span>.

&gt;&gt;&gt; <span class="kw">if</span> var == <span class="st">&quot;100&quot;</span>:
...     <span class="dt">print</span>(<span class="st">&quot;This message won&#39;t be printed out.&quot;</span>)
...</code></pre>
<p>Conditions can be expressed in a more complex way like:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; <span class="kw">if</span> a == b:
...     <span class="dt">print</span>(<span class="st">&#39;a and b are equals&#39;</span>)
... <span class="kw">elif</span> a &gt; b:
...    <span class="dt">print</span>(<span class="st">&#39;a is greater than b&#39;</span>)
... <span class="kw">else</span>:
...    <span class="dt">print</span>(<span class="st">&#39;b is greater than a&#39;</span>)</code></pre>
<p>The simple operators for comparisons are summarized in the next examples:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; a == b   <span class="co"># check if equals</span>
&gt;&gt;&gt; a != b   <span class="co"># check if different</span>
&gt;&gt;&gt; a &gt; b    <span class="co"># check if a is greater than b</span>
&gt;&gt;&gt; a &gt;= b   <span class="co"># check if a is greater or equal to b</span>
&gt;&gt;&gt; a &lt; b    <span class="co"># check if a is lesser than b</span>
&gt;&gt;&gt; a &lt;= b   <span class="co"># check if a is lesser or equal to b</span></code></pre>
<p>It is also possible to use the following operators:</p>
<ul>
<li><code>and</code>: called &quot;Logical AND operator&quot;. If both the operands are true then the condition becomes true.</li>
<li><code>or</code>: called &quot;Logical OR operator&quot;. If any of the two operands are non zero then the condition becomes true.</li>
<li><code>not</code> called &quot;Logical NOT operator&quot;. Use to reverses the logical state of its operand. If a condition is true then Logical NOT operator will make false.</li>
<li><code>in</code>: evaluates to true if it finds a variable in the specified sequence and false otherwise.</li>
</ul>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; <span class="kw">if</span> a == <span class="st">&quot;apples&quot;</span> and b == <span class="st">&quot;peers&quot;</span>:
...    <span class="dt">print</span>(<span class="st">&quot;You need to buy fruits.&quot;</span>)

&gt;&gt;&gt; <span class="kw">if</span> a == <span class="st">&quot;apples&quot;</span> or b == <span class="st">&quot;apples&quot;</span>:
...    <span class="dt">print</span>(<span class="st">&quot;You already have bought apples.&quot;</span>)

&gt;&gt;&gt; <span class="kw">if</span> <span class="st">&quot;tomatoas&quot;</span> not in to_buy:
...    <span class="dt">print</span>(<span class="st">&quot;You don&#39;t have to buy tomatoes.&quot;</span>)</code></pre>
<h3 id="loops">Loops</h3>
<p>The <code>for</code> loop statement iterates over the items of any sequence. The next Python lines of code print items of a list on the screen:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; to_buy = [<span class="st">&#39;fruits&#39;</span>, <span class="st">&#39;viande&#39;</span>, <span class="st">&#39;poisson&#39;</span>, <span class="st">&#39;oeufs&#39;</span>]
&gt;&gt;&gt; <span class="kw">for</span> item in to_buy:
...    <span class="dt">print</span>(item)
...
fruits
viande
poisson
oeufs</code></pre>
<p>A <code>while</code> loop statement repeatedly executes a target statement as long as a given condition returns <code>True</code>. The following example prints exactly the same result as the previous one:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; to_buy = [<span class="st">&#39;fruits&#39;</span>, <span class="st">&#39;viande&#39;</span>, <span class="st">&#39;poisson&#39;</span>, <span class="st">&#39;oeufs&#39;</span>]
&gt;&gt;&gt; i = <span class="dv">0</span>
&gt;&gt;&gt; <span class="kw">while</span> i &lt; <span class="dt">len</span>(to_buy):
...     <span class="dt">print</span>(to_buy[i])
...     i += <span class="dv">1</span>
...
fruits
viande
poisson
oeufs</code></pre>
<h3 id="dictionaries">Dictionaries</h3>
<p>A dictionary is a very useful data type. It consists of pairs of keys and their corresponding values.</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; fruits = <span class="dt">dict</span>()
&gt;&gt;&gt; fruits[<span class="st">&#39;apples&#39;</span>] = <span class="dv">3</span>
&gt;&gt;&gt; fruits[<span class="st">&#39;peers&#39;</span>] = <span class="dv">5</span>
&gt;&gt;&gt; fruits[<span class="st">&#39;tomatoas&#39;</span>] = <span class="dv">1</span></code></pre>
<p><code>fruits['apples']</code> is a way to get the value - i.e. 3, of the <code>apple</code> key. However, an error is sent if the key is unknown, like <code>fruits[bananas]</code>. Alternatively, the <code>get</code> function can be used, like <code>fruits.get(&quot;bananas&quot;, 0)</code> that returns 0 instead of an error.</p>
<p>The next example is showing how use a simple dictionary:</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt; <span class="kw">for</span> key in fruits:
...    value = fruits.get(key, <span class="dv">0</span>)
...    <span class="kw">if</span> value &lt; <span class="dv">3</span>:
...        <span class="dt">print</span>(<span class="st">&quot;You have to buy new {:s}.&quot;</span>.<span class="dt">format</span>(key))
...
You have to buy new tomatoes.</code></pre>
<p>To learn more about data structures and how to manage them, get access to <a href="https://docs.python.org/2/tutorial/datastructures.html">the Python documentation</a></p>
<h2 id="scripting-with-python">Scripting with Python</h2>
<p>This section describes how to create simple Python lines of code in separated files commonly called <em>scripts</em>, and run them. Some practical exercises, appropriate to the content of each action, are proposed and test exercises are suggested at the end of the section.</p>
<p>To practice, you have first to create a new folder in your computer - on your Desktop for example; with name &quot;pythonscripts&quot; for example, and to execute the python IDLE.</p>
<p>For an advanced use of Python, the installation of a dedicated IDE is very useful. SPPAS is developed with PyCharm: See <a href="https://www.jetbrains.com/help/pycharm/meet-pycharm.html">the PyCharm Help webpage</a></p>
<h3 id="comments-and-documentation">Comments and documentation</h3>
<p>Comments are not required by the program to work. But comments are necessary! Comments are expected to be appropriate, useful, relevant, adequate and always reasonable.</p>
<pre class="sourceCode python"><code class="sourceCode python"> <span class="co"># This script is doing this and that.</span>
 <span class="co"># It is under the terms of a license.</span>
 <span class="co"># and I can continue to write what I want after the # symbol</span>
 <span class="co"># except that it&#39;s not the right way to tell the story of my life</span></code></pre>
<p>The documentation of a program complements the comments. Both are not sharing the same goal: comments are used in all kind of programs but documentation is appended to comments for the biggest programs and/or projects. Documentation is automatically extracted and formatted thanks to dedicated tools. Documentation is required for sharing the program. See the <a href="https://www.python.org/dev/peps/pep-0257/">Docstring Conventions</a> for details. Documentation must follow a convention like for example the markup language <a href="https://en.wikipedia.org/wiki/ReStructuredText">reST - reStructured Text</a>. Both conventions are used into SPPAS API, programs and scripts.</p>
<h3 id="getting-started-with-scripting-in-python">Getting started with scripting in Python</h3>
<p>In the IDLE, create a new empty file either by clicking on &quot;File&quot; menu, then &quot;New File&quot;, or with the shortcut &quot;CTRL&quot;+N.</p>
<p>Copy the following line of code in this newly created file:</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="dt">print</span>(<span class="st">&quot;Hello world!&quot;</span>)</code></pre></td></tr></table>
<figure>
<img src="./etc/screenshots/python_idle_00.png" alt="Hello world! in a Python script" /><figcaption>Hello world! in a Python script</figcaption>
</figure>
<p>Then, save the file in the &quot;pythonscripts&quot; folder. By convention, Python source files end with a <em>.py</em> extension, and so the name <code>01_helloworld.py</code> could be fine.</p>
<p>To execute the program, you can do one of:</p>
<ul>
<li>with the mouse: Click on the Menu &quot;Run&quot;, then &quot;Run module&quot;</li>
<li>with the keyboard: Press F5</li>
</ul>
<p>The expected output is as follow:</p>
<figure>
<img src="./etc/screenshots/python_idle_01.png" alt="Output of the first script" /><figcaption>Output of the first script</figcaption>
</figure>
<p>A better practice while writing scripts is to describe by who, what and why this script was done. A nifty trick is to create a skeleton for any future script that will be written. Such ready-to-use script is available in the SPPAS package with the name <code>skeleton.py</code>.</p>
<h3 id="blocks">Blocks</h3>
<p>Blocks in Python are created from the indentation. Tab and spaces can be used but using spaces is recommended.</p>
<pre class="sourceCode python"><code class="sourceCode python">&gt;&gt;&gt;<span class="kw">if</span> a == <span class="dv">3</span>:
...    <span class="co"># this is a block using 4 spaces for indentation</span>
...    <span class="dt">print</span>(<span class="st">&quot;a is 3&quot;</span>)</code></pre>
<h3 id="functions">Functions</h3>
<h4 id="simple-function">Simple function</h4>
<p>A function does something: it stats with its definition then is followed by its lines of code in a block.</p>
<p>Here is an example of function:</p>
<table class="sourceCode python numberLines" startFrom="27"><tr class="sourceCode"><td class="lineNumbers"><pre>27
28
29
30
31
32
33
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> print_vowels():
    <span class="co">&quot;&quot;&quot; Print the list of French vowels on the screen. &quot;&quot;&quot;</span>
    
    vowels = [<span class="st">&#39;a&#39;</span>, <span class="st">&#39;e&#39;</span>, <span class="st">&#39;E&#39;</span>, <span class="st">&#39;i&#39;</span>, <span class="st">&#39;o&#39;</span>, <span class="st">&#39;u&#39;</span>, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;@&#39;</span>, <span class="st">&#39;2&#39;</span>, <span class="st">&#39;9&#39;</span>, <span class="st">&#39;a~&#39;</span>, <span class="st">&#39;o~&#39;</span>, <span class="st">&#39;U~&#39;</span>]
    <span class="dt">print</span>(<span class="st">&quot;List of French vowels:&quot;</span>)
    <span class="kw">for</span> v in vowels:
        <span class="dt">print</span>(v)</code></pre></td></tr></table>
<p>What the <code>print_vowels()</code> function is doing? This function declares a list with name <code>vowels</code>. Each item of the list is a string representing a vowel in French encoded in X-SAMPA. Of course, this list can be overridden with any other set of strings. The next line prints a message. Then, a loop prints each item of the list.</p>
<p>At this stage, if a script with this function is executed, it will do... nothing! Actually, the function is created, but it must be invoked in the main function to be interpreted by Python. The <code>main</code> is as follow:</p>
<table class="sourceCode python numberLines" startFrom="34"><tr class="sourceCode"><td class="lineNumbers"><pre>34
35
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">if</span> <span class="ot">__name__</span> == <span class="st">&#39;__main__&#39;</span>:
    print_vowels()</code></pre></td></tr></table>
<blockquote>
<p><em>Practice:</em> create a copy of the file <code>skeleton.py</code>, then make a function to print &quot;Hello World!&quot;. (solution: ex01_hello_world.py).</p>
</blockquote>
<blockquote>
<p><em>Practice</em>: Create a function to print plosives and call it in the main function (solution: ex02_functions.py).</p>
</blockquote>
<figure>
<img src="./etc/screenshots/python_idle_02.png" alt="Output of the second script" /><figcaption>Output of the second script</figcaption>
</figure>
<p>One can also create a function to print glides, another one to print affricates, and so on. Hum... this sounds a little bit fastidious!</p>
<h4 id="function-with-parameters">Function with parameters</h4>
<p>Rather than writing the same lines of code with only a minor difference over and over, we can declare <em>parameters</em> to the function to <em>make it more generic</em>. Notice that the number of parameters of a function is not limited!</p>
<p>In the example, we can replace the <code>print_vowels()</code> function and the <code>print_plosives()</code> function by a single function <code>print_list(mylist)</code> where <code>mylist</code> can be any list containing strings or characters. If the list contains other typed-variables like numerical values, they must be converted to string to be printed out. This can result in the following function:</p>
<table class="sourceCode python numberLines" startFrom="27"><tr class="sourceCode"><td class="lineNumbers"><pre>27
28
29
30
31
32
33
34
35
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> print_list(mylist, message=<span class="st">&quot;  -&quot;</span>):
    <span class="co">&quot;&quot;&quot; Print a list on the screen.</span>

<span class="co">    :param mylist: (list) the list to print</span>
<span class="co">    :param message: (string) an optional message to print before each element</span>

<span class="co">    &quot;&quot;&quot;</span>
    <span class="kw">for</span> item in mylist:
        <span class="dt">print</span>(<span class="st">&quot;{:s} {:s}&quot;</span>.<span class="dt">format</span>(message, item))</code></pre></td></tr></table>
<h4 id="function-return-values">Function return values</h4>
<p>Functions are used to do a specific job and the result of the function can be captured by the program. In the following example, the function would return a boolean value, i.e. True if the given string has no character.</p>
<table class="sourceCode python numberLines" startFrom="27"><tr class="sourceCode"><td class="lineNumbers"><pre>27
28
29
30
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> is_empty(mystr):
    <span class="co">&quot;&quot;&quot; Return True if mystr is empty. &quot;&quot;&quot;</span>
    
    <span class="kw">return</span> <span class="dt">len</span>(mystr.strip()) == <span class="dv">0</span></code></pre></td></tr></table>
<blockquote>
<p><em>Practice:</em> Add this function in a new script and try to print various lists (solution: ex03_functions.py)</p>
</blockquote>
<figure>
<img src="./etc/screenshots/python_idle_03.png" alt="Expected output of the 3rd script" /><figcaption>Expected output of the 3rd script</figcaption>
</figure>
<h3 id="readingwriting-files">Reading/Writing files</h3>
<h4 id="reading-data-from-a-file">Reading data from a file</h4>
<p>Now, we'll try to get data from a file. Create a new empty file with the following lines - and add as many lines as you want; then, save it with the name &quot;phonemes.csv&quot; by using UTF-8 encoding:</p>
<pre><code>occlusives ; b ; b 
occlusives ; d ; d 
fricatives ; f ; f 
liquids ; l ; l 
nasals ; m ; m 
nasals ; n ; n 
occlusives ; p ; p 
glides ; w ; w 
vowels ; a ; a 
vowels ; e ; e </code></pre>
<p>The following statements are typical statements used to read the content of a file. The first parameter of the <code>open</code> function is the name of the file, including the path (relative or absolute); and the second argument is the opening mode ('r' is the default value, used for reading).</p>
<blockquote>
<p><em>Practice:</em> Add these lines of code in a new script and try it (solution: ex04_reading_simple.py)</p>
</blockquote>
<table class="sourceCode python numberLines" startFrom="21"><tr class="sourceCode"><td class="lineNumbers"><pre>21
22
23
24
25
</pre></td><td class="sourceCode"><pre><code class="sourceCode python">fp = <span class="dt">open</span>(<span class="st">&quot;phonemes.csv&quot;</span>, <span class="st">&#39;r&#39;</span>)
<span class="kw">for</span> line in fp:
    <span class="co"># do something with the line stored in variable l</span>
    <span class="dt">print</span>(line.strip())
f.close()</code></pre></td></tr></table>
<p>The following is a solution with the ability to deal with various file encodings, thanks to the <code>codecs</code> library:</p>
<table class="sourceCode python numberLines" startFrom="21"><tr class="sourceCode"><td class="lineNumbers"><pre>21
22
23
24
25
26
27
28
29
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">def</span> read_file(filename):
    <span class="co">&quot;&quot;&quot; Get the content of file.</span>

<span class="co">    :param filename: (string) Name of the file to read, including path.</span>
<span class="co">    :returns: List of lines</span>

<span class="co">    &quot;&quot;&quot;</span>
    <span class="kw">with</span> codecs.<span class="dt">open</span>(filename, <span class="st">&#39;r&#39;</span>, encoding=<span class="st">&quot;utf8&quot;</span>) <span class="ch">as</span> fp:
        <span class="kw">return</span> fp.readlines()</code></pre></td></tr></table>
<p>In the previous code, the <code>codecs.open</code> functions got 3 parameters: the name of the file, the mode to open, and the encoding. The <code>readlines()</code> function gets each line of the file and store it into a list.</p>
<blockquote>
<p><em>Practice:</em> Write a script to print the content of a file (solution: ex05_reading_file.py)</p>
</blockquote>
<p>Notice that Python <code>os</code> module provides useful methods to perform file-processing operations, such as renaming and deleting. See Python documentation for details: <a href="https://docs.python.org/2/">https://docs.python.org/2/</a></p>
<h4 id="writing-data-to-a-file">Writing data to a file</h4>
<p>Writing a file requires to open it in a writing mode:</p>
<ul>
<li>'w' is the mode to write data; it will erase any existing file;</li>
<li>'a' is the mode to append data in an existing file.</li>
</ul>
<p>A file can be opened in an encoding and saved in another one. This could be useful to write a script to convert the encoding of a set of files. The following could help to create such script:</p>
<table class="sourceCode python numberLines" startFrom="10"><tr class="sourceCode"><td class="lineNumbers"><pre>10
11
12
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># getting all files of a given folder:</span>
path = <span class="st">&#39;C:\Users\Me\data&#39;</span>
dirs = os.listdir( path )</code></pre></td></tr></table>
<table class="sourceCode python numberLines" startFrom="15"><tr class="sourceCode"><td class="lineNumbers"><pre>15
16
17
18
19
20
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># Converting the encoding of a file:</span>
file_stream = codecs.<span class="dt">open</span>(file_location, <span class="st">&#39;r&#39;</span>, file_encoding)
file_output = codecs.<span class="dt">open</span>(file_location+<span class="st">&#39;utf8&#39;</span>, <span class="st">&#39;w&#39;</span>, <span class="st">&#39;utf-8&#39;</span>)

<span class="kw">for</span> line in file_stream:
    file_output.write(line)</code></pre></td></tr></table>
<h3 id="python-tutorials">Python tutorials</h3>
<p>Here is a list of web sites with tutorials, from the easiest to the most complete:</p>
<ol type="1">
<li><a href="http://www.learnpython.org/">Learn Python, by DataCamp</a></li>
<li><a href="https://www.tutorialspoint.com/python/">Tutorial Points</a></li>
<li><a href="https://docs.python.org/2/tutorial/">The Python documentation</a></li>
</ol>
<h3 id="exercises-to-practice">Exercises to practice</h3>
<blockquote>
<p>Exercise 1: How many vowels are in a list of phonemes? (solution: ex06_list.py)</p>
</blockquote>
<blockquote>
<p>Exercise 2: Write a X-SAMPA to IPA converter. (solution: ex07_dict.py)</p>
</blockquote>
<blockquote>
<p>Exercise 3: Compare 2 sets of data using NLP techniques (Zipf law, Tf.Idf) (solution: ex08_counter.py)</p>
</blockquote>
<h2 id="anndata-an-api-to-manage-annotated-data">anndata, an API to manage annotated data</h2>
<h3 id="overview">Overview</h3>
<p>We are now going to write Python scripts using the <em>anndata</em> API included in SPPAS. This API is useful to read/write and manipulate files annotated from various annotation tools like SPPAS, Praat or Elan.</p>
<p>First of all, it is important to understand the data structure included into the API to be able to use it efficiently.</p>
<h3 id="why-developing-a-new-api">Why developing a new API?</h3>
<p>In the Linguistics field, multimodal annotations contain information ranging from general linguistic to domain specific information. Some are annotated with automatic tools, and some are manually annotated. In annotation tools, annotated data are mainly represented in the form of &quot;tiers&quot; or &quot;tracks&quot; of annotations. Tiers are mostly series of intervals defined by:</p>
<ul>
<li>a time point to represent the beginning of the interval;</li>
<li>a time point to represent the end of the interval;</li>
<li>a label to represent the annotation itself.</li>
</ul>
<p>Of course, depending on the annotation tool, the internal data representation and the file formats are different. In Praat, tiers can be represented by a time point and a label (such tiers are respectively named PointTiers and IntervalTiers). IntervalTiers are made of a succession of consecutive intervals (labelled or un-labelled). In Elan, points are not supported; and unlabelled intervals are not represented nor saved.</p>
<p>The <em>anndata</em> API was designed to be able to manipulate all data in the same way, regardless of the file type. It supports to merge data and annotations from a wide range of heterogeneous data sources.</p>
<h3 id="the-api-class-diagram">The API class diagram</h3>
<p>After opening/loading a file, its content is stored in a <code>sppasTranscription</code> object. A <code>sppasTranscription</code> has a name, and a list of <code>sppasTier</code> objects. Tiers can't share the same name, the list of tiers can be empty, and a hierarchy between tiers can be defined. Actually, subdivision relations can be established between tiers. For example, a tier with phonemes is a subdivision reference for syllables, or for tokens; and tokens are a subdivision reference for the orthographic transcription in IPUs. Such subdivisions can be of two categories: alignment or association.</p>
<p>A <code>sppasTier</code> object has a name, and a list of <code>sppasAnnotation</code> objects. It can also be associated to a controlled vocabulary, or a media.</p>
<p>Al these objects contain a set of meta-data.</p>
<p>An annotation is made of 2 objects:</p>
<ul>
<li>a <code>sppasLocation</code> object,</li>
<li>a list of <code>sppasLabel</code> objects.</li>
</ul>
<p>A <code>sppasLabel</code> object is representing the &quot;content&quot; of the annotation. It is a list of <code>sppasTag</code> each one associated to a score.</p>
<p>A <code>sppasLocation</code> is representing where this annotation occurs in the media. Then, a <code>sppasLocation</code> is made of a list of localization each one associated with a score. A localization is one of:</p>
<ul>
<li>a <code>sppasPoint</code> object; or</li>
<li>a <code>sppasInterval</code> object, which is made of 2 <code>sppasPoint</code> objects; or</li>
<li>a <code>sppasDisjoint</code> object which is a list of <code>sppasInterval</code>.</li>
</ul>
<figure>
<img src="./etc/figures/anndata.png" alt="API class diagram" /><figcaption>API class diagram</figcaption>
</figure>
<h4 id="label-representation">Label representation</h4>
<p>Each annotation holds a serie of 0..N labels, mainly represented in the form of a string, freely written by the annotator or selected from a list of categories.</p>
<h4 id="location-representation">Location representation</h4>
<p>In the <em>anndata</em> API, a <code>sppasPoint</code> is considered <em>as an imprecise value</em>. It is possible to characterize a point in a space immediately allowing its vagueness by using:</p>
<ul>
<li>a midpoint value (center) of the point;</li>
<li>a radius value.</li>
</ul>
<figure>
<img src="./etc/figures/timepoint-represent.png" alt="Representation of a sppasPoint" /><figcaption>Representation of a sppasPoint</figcaption>
</figure>
<h4 id="example">Example</h4>
<p>The screenshot below shows an example of multimodal annotated data, imported from 3 different annotation tools. Each <code>sppasPoint</code> is represented by a vertical dark-blue line with a gradient color to refer to the radius value.</p>
<p>In the screenshot the following radius values were assigned:</p>
<ul>
<li>0ms for prosody,</li>
<li>5ms for phonetics, discourse and syntax</li>
<li>40ms for gestures.</li>
</ul>
<figure>
<img src="./etc/screenshots/Grenelle.png" alt="Example of multimodal data" /><figcaption>Example of multimodal data</figcaption>
</figure>
<h2 id="creating-scripts-with-anndata">Creating scripts with anndata</h2>
<h3 id="preparing-the-data">Preparing the data</h3>
<p>To practice, you have first to create a new folder in your computer - on your Desktop for example; with name &quot;sppasscripts&quot; for example, and to execute the python IDLE.</p>
<p>Open a File Explorer window and go to the SPPAS folder location. Then, copy the <code>sppas</code> directory into the newly created &quot;sppasscripts&quot; folder. Then, go to the solution directory and copy/paste the files <code>skeleton-sppas.py</code> and <code>F_F_B003-P9-merge.TextGrid</code> into your &quot;sppasscripts&quot; folder. Then, open the skeleton script with the python IDLE and execute it. It will do... nothing! But now, you are ready to do something with the API of SPPAS!</p>
<p>When using the API, if something forbidden is attempted, the object will raise an Exception. It means that the program will stop except if the script &quot;raises&quot; the exception.</p>
<h3 id="readwrite-annotated-files">Read/Write annotated files</h3>
<p>We are being to Open/Read an annotated file of any format (XRA, TextGrid, Elan, ...) and store it into a <code>sppasTranscription</code> object instance. Then, it will be saved into another file.</p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># Create a parser object then parse the input file.</span>
parser = sppasRW(input_filename)
trs = parser.read()

<span class="co"># Save the sppasTranscription object into a file.</span>
parser.set_filename(output_filename)
parser.write(trs)</code></pre></td></tr></table>
<p>Only these two lines of code are required to convert a file from a format to another one! The appropriate parsing system is extracted from the extension of file name.</p>
<p>To get the list of accepted extensions that the API can read, just use <code>aio.extensions_in</code>. The list of accepted extensions that the API can write is given by <code>aio.extensions_out</code>.</p>
<blockquote>
<p><em>Practice:</em> Write a script to convert a TextGrid file into CSV (solution: ex10_read_write.py)</p>
</blockquote>
<h3 id="manipulating-a-sppastranscription-object">Manipulating a sppasTranscription object</h3>
<p>The most useful functions to manage tiers of a sppasTranscription object are:</p>
<ul>
<li><code>create_tier()</code> to create an empty tier and to append it,</li>
<li><code>append(tier)</code> to add a tier into the sppasTranscription,</li>
<li><code>pop(index)</code> to remove a tier of the sppasTranscription,</li>
<li><code>find(name, case_sensitive=True)</code> to find a tier from its name.</li>
</ul>
<table class="sourceCode python numberLines" startFrom="15"><tr class="sourceCode"><td class="lineNumbers"><pre>15
16
17
18
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="kw">for</span> tier in trs:
    <span class="co"># do something with the tier:</span>
    <span class="dt">print</span>(tier.get_name())
phons_tier = trs.find(<span class="st">&quot;PhonAlign&quot;</span>)</code></pre></td></tr></table>
<blockquote>
<p><em>Practice:</em> Write a script to select a set of tiers of a file and save them into a new file (solution: ex11_transcription.py).</p>
</blockquote>
<h3 id="manipulating-a-sppastier-object">Manipulating a sppasTier object</h3>
<p>A tier is made of a name, a list of annotations, and optionally a controlled vocabulary and a media. To get the name of a tier, or to fix a new name, the easier way is to use <code>tier.get_name()</code>. The following block of code allows to get a tier and change its name.</p>
<table class="sourceCode python numberLines" startFrom="43"><tr class="sourceCode"><td class="lineNumbers"><pre>43
44
45
46
47
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># Get the first tier, with index=0</span>
tier = trs[<span class="dv">0</span>]
<span class="dt">print</span>(tier.get_name())
tier.set_name(<span class="st">&quot;NewName&quot;</span>)
<span class="dt">print</span>(tier.get_name())</code></pre></td></tr></table>
<p>The most useful functions to manage annotations of a <code>sppasTier</code> object are:</p>
<ul>
<li><code>create_annotation(location, labels)</code> to create and add a new annotation</li>
<li><code>append(annotation)</code> to add a new annotation at the end of the list</li>
<li><code>add(annotation)</code> to add a new annotation</li>
<li><code>pop(index)</code> to delete the annotation of a given index</li>
<li><code>remove(begin, end)</code> to remove annotations of a given localization range</li>
<li><code>is_disjoint()</code>, <code>is_interval()</code>, <code>is_point()</code> to know the type of location</li>
<li><code>is_string()</code>, <code>is_int()</code>, <code>is_float()</code>, <code>is_bool()</code> to know the type of labels</li>
<li><code>find(begin, end)</code> to get annotations in a given localization range</li>
<li><code>get_first_point()</code>, <code>get_last_point()</code> to get respectively the point with the lowest or highest localization</li>
<li><code>set_radius(radius)</code> to fix the same vagueness value to each localization point</li>
</ul>
<blockquote>
<p>Practice: Write a script to open an annotated file and print information about tiers (solution: ex12_tiers_info.py)</p>
</blockquote>
<h3 id="manipulating-a-sppasannotation-object">Manipulating a sppasAnnotation object</h3>
<p>An annotation is a container for a location and optionally a list of labels. It can be used to manage the labels and tags with the following methods:</p>
<ul>
<li><code>is_labelled()</code> returns True if at least a <code>sppasTag</code> exists and is not None</li>
<li><code>append_label(label)</code> to add a label at the end of the list of labels</li>
<li><code>get_labels_best_tag()</code> returns a list with the best tag of each label</li>
<li><code>add_tag(tag, score, label_index)</code> to add a tag into a label</li>
<li><code>remove_tag(tag, label_index)</code> to remove a tag of a label</li>
<li><code>serialize_labels()</code> to get a string representing the sequence of labels</li>
</ul>
<p>An annotation object can also be copied with the method <code>copy()</code>. The location, the labels and the metadata are all copied; and the 'id' of the returned annotation is then the same. It is expected that each annotation of a tier as its own 'id', but the API doesn't check this.</p>
<blockquote>
<p><em>Practice</em>: Write a script to print information about annotations of a tier (solution: ex13_tiers_info.py)</p>
</blockquote>
<h3 id="search-in-annotations-filters">Search in annotations: Filters</h3>
<h4 id="overview-1">Overview</h4>
<p>This section focuses on the problem of <em>searching and retrieving</em> data from annotated corpora.</p>
<p>The filter implementation can only be used together with the <code>sppasTier()</code> class. The idea is that each <code>sppasTier()</code> can contain a set of filters, that each reduce the full list of annotations to a subset.</p>
<p>SPPAS filtering system proposes 2 main axis to filter such data:</p>
<ul>
<li>with a boolean function based either on the content, the duration or on the time of annotations,</li>
<li>with a relation function between annotation locations of 2 tiers.</li>
</ul>
<p>A set of filters can be created and combined to get the expected result. To be able to apply filters to a tier, some data must be loaded first. First, a new <code>sppasTranscription()</code> has to be created when loading a file. Then, the tier(s) to apply filters on must be fixed. Finally, if the input file was NOT an XRA, it is widely recommended to fix a radius value before using a relation filter.</p>
<pre class="sourceCode python"><code class="sourceCode python">f = sppasFilter(tier)</code></pre>
<p>When a filter is applied, it returns an instance of <code>sppasAnnSet</code> which is the set of annotations matching with the request. It also contains a 'value' which is the list of functions that are truly matching for each annotation. Finally, <code>sppasAnnSet</code> objects can be combined with the operators '|' and '&amp;', and expected to a <code>sppasTier</code> instance.</p>
<h4 id="filter-on-the-tag-content">Filter on the tag content</h4>
<p>The following matching names are proposed to select annotations:</p>
<ul>
<li>'exact': means that a tag is valid if it strictly corresponds to the expected pattern;</li>
<li>'contains' means that a tag is valid if it contains the expected pattern;</li>
<li>'startswith' means that a tag is valid if it starts with the expected pattern;</li>
<li>'endswith' means that a tag is valid if it ends with the expected pattern.</li>
<li>'regexp' to define regular expressions.</li>
</ul>
<p>All these matches can be reversed, to represent does not exactly match, does not contain, does not start with or does not end with. Moreover, they can be case-insensitive by adding 'i' at the beginning like 'iexact', etc. The full list of tag matching functions is obtained by invoking <code>sppasTagCompare().get_function_names()</code>.</p>
<p>The next examples illustrate how to work with such pattern matching filter. In this example, <code>f1</code> is a filter used to get all phonemes with the exact label 'a'. On the other side, <code>f2</code> is a filter that ignores all phonemes matching with 'a' (mentioned by the symbol '~') with a case insensitive comparison (iexact means insensitive-exact).</p>
<pre class="sourceCode python"><code class="sourceCode python">tier = trs.find(<span class="st">&quot;PhonAlign&quot;</span>)
f = sppasFilter(tier)
ann_set_a = f.tag(exact=<span class="st">&#39;a&#39;</span>)
ann_set_aA = f.tag(iexact=<span class="st">&#39;a&#39;</span>)</code></pre>
<p>The next example illustrates how to write a complex request. Notice that r1 is equal to r2, but getting r1 is faster:</p>
<pre class="sourceCode python"><code class="sourceCode python">tier = trs.find(<span class="st">&quot;TokensAlign&quot;</span>)
f = sppasFilter(tier)
r1 = f.tag(startswith=<span class="st">&quot;pa&quot;</span>, not_endswith=<span class="st">&#39;a&#39;</span>, logic_bool=<span class="st">&quot;and&quot;</span>)
r2 = f.tag(startswith=<span class="st">&quot;pa&quot;</span>) &amp; f.tag(not_endswith=<span class="st">&#39;a&#39;</span>)</code></pre>
<p>With this notation in hands, it is easy to formulate queries like for example: <em>Extract words starting by &quot;ch&quot; or &quot;sh&quot;</em>:</p>
<pre class="sourceCode python"><code class="sourceCode python">result = f.tag(startswith=<span class="st">&quot;ch&quot;</span>) | f.tag(startswith=<span class="st">&quot;sh&quot;</span>)</code></pre>
<blockquote>
<p><em>Practice:</em>: Write a script to extract phonemes /a/ then phonemes /a/, /e/, /A/ and /E/. (solution: ex15_annotation_label_filter.py).</p>
</blockquote>
<h4 id="filter-on-the-duration">Filter on the duration</h4>
<p>The following matching names are proposed to select annotations:</p>
<ul>
<li>'lt' means that the duration of the annotation is lower than the given one;</li>
<li>'le' means that the duration of the annotation is lower or equal than the given one;</li>
<li>'gt' means that the duration of the annotation is greater than the given one;</li>
<li>'ge' means that the duration of the annotation is greater or equal than the given one;</li>
<li>'eq' means that the duration of the annotation is equal to the given one;</li>
<li>'ne' means that the duration of the annotation is not equal to the given one.</li>
</ul>
<p>The full list of duration matching functions is obtained by invoking <code>sppasDurationCompare().get_function_names()</code>.</p>
<p>Next example shows how to get phonemes during between 30 ms and 70 ms. Notice that r1 and r2 are equals!</p>
<pre class="sourceCode python"><code class="sourceCode python">tier = trs.find(<span class="st">&quot;PhonAlign&quot;</span>)
f = sppasFilter(tier)
r1 = f.dur(ge=<span class="fl">0.03</span>) &amp; f.dur(le=<span class="fl">0.07</span>)
r2 = f.dur(ge=<span class="fl">0.03</span>, le=<span class="fl">0.07</span>, logic_bool=<span class="st">&quot;and&quot;</span>)</code></pre>
<blockquote>
<p><em>Practice</em>: Extract phonemes 'a' or 'e' during more than 100ms (solution: ex16_annotation_dur_filter.py).</p>
</blockquote>
<h4 id="filter-on-position-in-time">Filter on position in time</h4>
<p>The following matching names are proposed to select annotations:</p>
<ul>
<li>rangefrom allows to fix the begin time value,</li>
<li>rangeto allows to fix the end time value.</li>
</ul>
<p>Next example allows to extract phonemes 'a' of the 5 first seconds:</p>
<pre class="sourceCode python"><code class="sourceCode python">tier = trs.find(<span class="st">&quot;PhonAlign&quot;</span>)
f = sppasFilter(tier)
result = f.tag(exact=<span class="st">&#39;a&#39;</span>) &amp; f.loc(rangefrom=<span class="dv">0</span>., rangeto=<span class="dv">5</span>., logic_bool=<span class="st">&quot;and&quot;</span>)</code></pre>
<h4 id="creating-a-relation-function">Creating a relation function</h4>
<p>Relations between annotations is crucial if we want to extract multimodal data. The aim here is to select intervals of a tier depending on what is represented in another tier.</p>
<p>James Allen, in 1983, proposed an algebraic framework named Interval Algebra (IA), for qualitative reasoning with time intervals where the binary relationship between a pair of intervals is represented by a subset of 13 atomic relation, that are:</p>
<ul>
<li><p>distinct because no pair of definite intervals can be related by more than one of the relationships;</p></li>
<li><p>exhaustive because any pair of definite intervals are described by one of the relations;</p></li>
<li><p>qualitative (rather than quantitative) because no numeric time spans are considered.</p></li>
</ul>
<p>These relations and the operations on them form &quot;Allen's Interval Algebra&quot;.</p>
<p>Pujari, Kumari and Sattar proposed INDU in 1999: an Interval &amp; Duration network. They extended the IA to model qualitative information about intervals and durations in a single binary constraint network. Duration relations are: greater, lower and equal. INDU comprises of 25 basic relations between a pair of two intervals.</p>
<p><code>anndata</code> implements the 13 Allen interval relations: before, after, meets, met by, overlaps, overlapped by, starts, started by, finishes, finished by, contains, during and equals; and it also contains the relations proposed in the INDU model. The full list of matching functions is obtained by invoking <code>sppasIntervalCompare().get_function_names()</code>.</p>
<p>Moreover, in the implementation of <code>anndata</code>, some functions accept options:</p>
<ul>
<li><code>before</code> and <code>after</code> accept a <code>max_delay</code> value,</li>
<li><code>overlaps</code> and <code>overlappedby</code> accept an <code>overlap_min</code> value and a boolean <code>percent</code> which defines whether the value is absolute or is a percentage.</li>
</ul>
<p>The next example returns monosyllabic tokens and tokens that are overlapping a syllable (only if the overlap is during more than 40 ms):</p>
<pre class="sourceCode python"><code class="sourceCode python">tier = trs.find(<span class="st">&quot;TokensAlign&quot;</span>)
other_tier = trs.find(<span class="st">&quot;Syllables&quot;</span>)
f = sppasFilter(tier)
f.rel(other_tier, <span class="st">&quot;equals&quot;</span>, <span class="st">&quot;overlaps&quot;</span>, <span class="st">&quot;overlappedby&quot;</span>, min_overlap=<span class="fl">0.04</span>)</code></pre>
<p>Below is another example of implementing a request. <em>Which syllables stretch across 2 words?</em></p>
<table class="sourceCode python numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="sourceCode"><pre><code class="sourceCode python"><span class="co"># Get tiers from a sppasTranscription object</span>
tier_syll = trs.find(<span class="st">&quot;Syllables&quot;</span>)
tier_toks = trs.find(<span class="st">&quot;TokensAlign&quot;</span>)
f = sppasFilter(tier_syll)

<span class="co"># Apply the filter with the relation function</span>
ann_set = f.rel(tier_toks, <span class="st">&quot;overlaps&quot;</span>, <span class="st">&quot;overlappedby&quot;</span>)

<span class="co"># To convert filtered data into a tier:</span>
tier = ann_set.to_tier(<span class="st">&quot;SyllStretch&quot;</span>)</code></pre></td></tr></table>
<blockquote>
<p><em>Practice 1</em>: Create a script to get tokens followed by a silence. (solution: ex17_annotations_relation_filter1.py).</p>
</blockquote>
<blockquote>
<p><em>Practice 2</em>: Create a script to get tokens preceded by OR followed by a silence. (solution: ex17_annotations_relation_filter2.py).</p>
</blockquote>
<blockquote>
<p><em>Practice 3</em>: Create a script to get tokens preceded by AND followed by a silence. (solution: ex17_annotations_relation_filter3.py).</p>
</blockquote>
<h2 id="more-with-sppas...">More with SPPAS...</h2>
<p>In addition to <em>anndata</em>, SPPAS contains several other API. They are all free and open source Python libraries, with a documentation and a set of tests.</p>
<p>Among others:</p>
<ul>
<li><em>audiodata</em> to manage digital audio data: load, get information, extract channels, re-sample, search for silences, mix channels, etc.</li>
<li><em>calculus</em> to perform some math on data, including descriptive statistics.</li>
<li><em>resources</em> to access and manage linguistic resources like lexicons, dictionaries, etc.</li>
</ul>

    </div>
    </div>

    <!----------------------------------------------------------------->

    <div class="footer">
        <a href="index.html"><img src="./etc/logos/sppas-logo.png" alt="SPPAS"></a>
        <p class="copyright">
            <a href="mailto:contact@sppas.org">Brigitte Bigi</a> &copy; 2011-2018
        </p>
    </div>

    <!----------------------------------------------------------------->

    <span class="scrollT"></span>
    <script type="text/javascript" src="./etc/scripts/jquery.min.js"></script>
    <script type="text/javascript" src="./etc/scripts/scrollT.js"></script>
    <script type="text/javascript">
        // On active la fonction permettant de faire apparaitre l'indicateur 
        // de scroll pour remonter en haut de page.
        $(document).ready(function() 
        {
            $(this).scrollT();
        });
    </script>

    <!----------------------------------------------------------------->
</body>
</html>
